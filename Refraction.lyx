#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass article
\use_default_options true
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures true
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry false
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine biblatex
\cite_engine_type authoryear
\biblatex_bibstyle authoryear
\biblatex_citestyle authoryear
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
AeroPlygiant Refraction Model
\end_layout

\begin_layout Abstract
This note summarizes development of equations governing the three dimensional
 propagation of an optical ray path traversing a volume of space associated
 with an arbitrarily complex refractive media.
 First discrete numerical method is developed.
 Then attempts are made to cast this into differential form.
\end_layout

\begin_layout Standard
\begin_inset Box Shadowbox
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
Note: Tentative exploratory content for discussion.
 Many items are likely wrong!!! Material is for exploring ideas and mathematical
 relationships.
 Not for production use!!!
\end_layout

\end_inset


\end_layout

\begin_layout Section
Background
\end_layout

\begin_layout Subsection
Basic Methods
\end_layout

\begin_layout Standard
The concepts of atmospheric refraction, in the context of astronomical observati
on, are described in
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citet
key "Young:AstroRefraction"
literal "false"

\end_inset

.
 The concept of the approach taken here, but for scalar math model is summarized
 in
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citet
key "Tatum:DiffEqRefraction"
literal "false"

\end_inset

.
\end_layout

\begin_layout Subsection
Useful resources
\end_layout

\begin_layout Standard
TODO/TBD - review and summarize prior work and references
\end_layout

\begin_layout Subsubsection
General Refraction Theory
\end_layout

\begin_layout Paragraph
Nishidate, Yohei
\end_layout

\begin_layout Standard
Using Fermat's principal, solving electromagnetic wave equations, etc.
 Good references to other work
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citet
key "Nishidate:RefractionMetricTensor"
literal "false"

\end_inset

.
\end_layout

\begin_layout Paragraph
Ren
\end_layout

\begin_layout Standard
Derivation of 
\begin_inset Quotes eld
\end_inset

ray equation
\begin_inset Quotes erd
\end_inset

 in
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citet
key "Ren2019:RefractDiffEqs"
literal "false"

\end_inset

.
 But somewhat difficult to understand (many terms and ideas are introduced
 without explanation - perhaps prior works provide more insight).
\end_layout

\begin_layout Paragraph
Walter Bislin's Blog
\end_layout

\begin_layout Standard
Informal, but perhaps worth a read...
\end_layout

\begin_layout Itemize
http://walter.bislins.ch/bloge/index.asp?page=Deriving+Equations+for+Atmospheric+Re
fraction
\end_layout

\begin_layout Paragraph
Berton, Roland
\end_layout

\begin_layout Standard
Addressing refraction in context of global sensing models
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citet
key "Berton_2006"
literal "false"

\end_inset

 and
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citet
key "Berton_2007"
literal "false"

\end_inset

.
 
\begin_inset Quotes eld
\end_inset

In this second part the method is applied in order to examine the influence
 of various elements on the positioning of a target in the visible and near-infr
ared.
 Ciddor's formula of the refractive index has been adopted here.
\begin_inset Quotes erd
\end_inset


\end_layout

\begin_layout Itemize
https://iopscience.iop.org/article/10.1088/1464-4258/8/10/001
\end_layout

\begin_layout Itemize
https://iopscience.iop.org/article/10.1088/1464-4258/9/7/010/pdf
\end_layout

\begin_layout Subsubsection
Astronomy - Specific Theory
\end_layout

\begin_layout Paragraph
Nauenberg, Michael
\end_layout

\begin_layout Standard
Astronomy style derivation from (physics department of University of California)
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citet
key "nauenberg2016:atmospheric"
literal "false"

\end_inset

.
 Describes deviations from long assumed temperature profile models.
\end_layout

\begin_layout Paragraph
Michael E.
 Thomas and Richard I.
 Josef
\end_layout

\begin_layout Standard
Practical equations for determining refraction deviation angle observed
 at ground looking into space.
\end_layout

\begin_layout Itemize
https://secwww.jhuapl.edu/techdigest/Content/techdigest/pdf/V17-N03/17-03-Thomas.pd
f
\end_layout

\begin_layout Subsubsection
Remote Sensing - Specific Theory
\end_layout

\begin_layout Paragraph
Gyer:
\end_layout

\begin_layout Standard
Refraction model that is (very) suitable for remote sensing applications
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citet
key "gyer1996:AtmRefraction"
literal "false"

\end_inset

.
 Model includes spherically stratified atmosphere with index of refraction
 values derived from empirical measurement of pressure temperature (and
 humidity?).
\end_layout

\begin_layout Paragraph
Vermeer:
\end_layout

\begin_layout Standard
Development of refraction equations for near vertical photograph (e.g.
 up to 60-deg or so) based on horizontally stratified atmosphere
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citet
key "Vermeer2019OnTA:Refraction"
literal "false"

\end_inset

.
 Focused on a more intuitive derivation (e.g.
 for better understanding and education).
\end_layout

\begin_layout Paragraph
Xiaohong Peng
\end_layout

\begin_layout Standard
Spatio-temporal global model based on available global temperature, pressure,
 and relative humidity (T,P,RH) measurements
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citet
key "Peng:SpatioTemporalGlobal"
literal "false"

\end_inset

.
 Data used are from 
\begin_inset Quotes eld
\end_inset

NCEP GDAS/FNL 0.25 Degree Global Tropospheric Analyses and Forecast Grids
 (083.3)
\begin_inset Quotes erd
\end_inset

 which has 6-hr updates.
 Uses cubic spline interpolation of the index of refraction values between
 measurements.
 Discusses various models for estimating IoR from T,P,RH.
 Work based on model of Ciddor using T,P,RH and CO2 content.
\end_layout

\begin_layout Subsubsection
Sensing and Sounding Data
\end_layout

\begin_layout Paragraph
NCEP GDAS/FNL 0.25 Degree Global Tropospheric Analyses and Forecast Grids
\end_layout

\begin_layout Standard
Modeling of atmosphere with data gathered from multiple sources
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citet
key "NCAR:cisl_rda_ds083.3"
literal "false"

\end_inset

.
 Models are updated every 6 hours and forecasts for 3 hours ahead are provided.
\end_layout

\begin_layout Paragraph
University Wyoming
\end_layout

\begin_layout Standard
Daily sounding data
\end_layout

\begin_layout Itemize
http://weather.uwyo.edu/upperair/sounding.html
\end_layout

\begin_layout Paragraph
Windy.com
\end_layout

\begin_layout Standard
Data fetching and interpolation resource
\end_layout

\begin_layout Itemize
https://www.windy.com
\end_layout

\begin_layout Subsubsection
Index of Refraction Estimation
\end_layout

\begin_layout Paragraph
Andrew T.
 Young
\end_layout

\begin_layout Standard
Inventory of formulae and methods used (recommends use of Ciddor)
\end_layout

\begin_layout Itemize
https://aty.sdsu.edu/explain/atmos_refr/air_refr.html
\end_layout

\begin_layout Paragraph
Ciddor
\end_layout

\begin_layout Standard
Rigorous equations for estimating refraction (effort of national standards)
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citet
key "Ciddor:FormulaIoR"
literal "false"

\end_inset

.
 Note that there are two follow works (dealing with group velocities, and
 then CO2 and H2O content).
\end_layout

\begin_layout Itemize
https://pubmed.ncbi.nlm.nih.gov/21085275/
\end_layout

\begin_layout Itemize
https://pubmed.ncbi.nlm.nih.gov/18305787/
\end_layout

\begin_layout Itemize
https://pubmed.ncbi.nlm.nih.gov/12003222/
\end_layout

\begin_layout Paragraph
NIST - Refractive Index of Air Calculator
\end_layout

\begin_layout Standard
Engineering metrology tool box:
\end_layout

\begin_layout Itemize
https://emtoolbox.nist.gov/Wavelength/Documentation.asp#EdlenorCiddor
\end_layout

\begin_layout Subsubsection
Numeric Solution Techniques
\end_layout

\begin_layout Paragraph
Tadmor, Eitan
\end_layout

\begin_layout Standard
Review of numerical methods for nonlinear PDEs
\end_layout

\begin_layout Itemize
https://www.math.umd.edu/~tadmor/pub/PDEs/Tadmor%20BAMS_v49-2012.pdf
\end_layout

\begin_layout Paragraph
Bui, Timothy
\end_layout

\begin_layout Standard
Forward and Backward Euler's methods
\end_layout

\begin_layout Itemize
https://digitalcommons.lib.uconn.edu/cgi/viewcontent.cgi?article=1118&context=srhono
rs_theses
\end_layout

\begin_layout Section
Discrete Step Approximation
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 1
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename Refraction_NodeGeometry.ipe
	width 100col%

\end_inset


\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:PathChangeIllustration"

\end_inset

Illustration of path change at 
\begin_inset Formula $i$
\end_inset

-th evaluation node.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset

As a starting point, first consider the fundamental geometry and properties
 of optical refraction within one small layer of a continuous propagation
 medium as illustrated in Figure
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:PathChangeIllustration"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
\end_layout

\begin_layout Standard
An individual discrete refraction step con be associated with an ray path
 passing through a contour surface of equal index of refraction value (e.g.
 contour 
\begin_inset Formula $\nu_{i}$
\end_inset

 in the figure).
 The ray path is incident on this surface with an incident tangent direction,
 
\begin_inset Formula $t_{i-1}$
\end_inset

, and exits the surface with new tangent direction, 
\begin_inset Formula $t_{i+1}$
\end_inset

.
 The ray path is coming from a region with index of refraction, 
\begin_inset Formula $\nu_{i-1}$
\end_inset

, and proceeding into a region with index, 
\begin_inset Formula $\nu_{i+1}$
\end_inset

.
\end_layout

\begin_layout Subsection
Initial Condition Values
\end_layout

\begin_layout Description
\begin_inset Formula $t_{0}$
\end_inset

 
\emph on
Incident
\emph default
 tangent direction (unitary vector) that is 
\emph on
incoming
\emph default
 at start point
\end_layout

\begin_layout Description
\begin_inset Formula $r_{0}$
\end_inset

 Vector location at which the incoming ray is incident into the refracting
 media of interest - i.e.
 the start point of the ray (curvilinear/polynomial) path to be determined.
\end_layout

\begin_layout Subsection
Propagation Environment
\end_layout

\begin_layout Standard
Assume the ability to evaluate the following quantities on demand for arbitrary
 locations, 
\begin_inset Formula $r_{i}$
\end_inset

,
\end_layout

\begin_layout Description
\begin_inset Formula $\nu_{i}$
\end_inset

 Index of refraction at point 
\begin_inset Formula $r_{i}$
\end_inset


\end_layout

\begin_layout Description
\begin_inset Formula $g_{i}$
\end_inset

 Gradient of index of refraction, 
\begin_inset Formula $\nu$
\end_inset

, at 
\begin_inset Formula $r_{i}$
\end_inset

, i.e.
\begin_inset Formula 
\[
g_{i}=\nabla\nu\left(r_{i}\right)
\]

\end_inset

In Cartesian coordinate system with constant orthonormal vector basis, 
\begin_inset Formula $\left\{ e_{k}\right\} $
\end_inset

, the gradient at location, 
\begin_inset Formula $r=\sum_{k}\rho_{k}e_{k}$
\end_inset

 is
\begin_inset Formula 
\[
\nabla\nu\equiv\left(\sum_{k}e_{k}\frac{\partial}{\partial\rho_{k}}\right)\nu\left(r\right)
\]

\end_inset

In spherical polar coordinates, with (location dependent) orthonormal basis,
 
\begin_inset Formula $\left\{ e_{r},e_{\vartheta},e_{\phi}\right\} $
\end_inset

, the gradient at location, 
\begin_inset Formula $r=r\left(\rho,\vartheta,\phi\right)$
\end_inset

, is
\begin_inset Formula 
\[
\nabla\nu=\left(e_{r}\frac{\partial}{\partial\rho}+e_{\vartheta}\frac{1}{\rho}\frac{\partial}{\partial\vartheta}+e_{\phi}\frac{1}{\rho\sin\vartheta}\frac{\partial}{\partial\phi}\right)\nu\left(r\right)
\]

\end_inset


\end_layout

\begin_layout Description
\begin_inset Formula $u_{i}$
\end_inset

 Unit direction of gradient, 
\begin_inset Formula $g_{i}$
\end_inset

,
\begin_inset Formula 
\[
u_{i}=\hat{g}_{i}=\frac{g_{i}}{\left|g_{i}\right|}=\left.\frac{\nabla\nu}{\left|\nabla\nu\right|}\right|_{i}
\]

\end_inset

NOTE, that this is 
\emph on
not defined
\emph default
 where 
\begin_inset Formula $\left|g_{i}\right|=0$
\end_inset

 - i.e.
 in regions where the index of refraction is constant
\end_layout

\begin_layout Description
\begin_inset Formula $\mathrm{H}_{g}$
\end_inset

 Hessian matrix for index of refraction, 
\begin_inset Formula $\nu$
\end_inset

, in Cartesian frame,
\begin_inset Formula 
\[
\left\{ \mathrm{H}_{g}\right\} _{ij}\equiv\frac{\partial^{2}}{\partial\rho_{i}\partial\rho_{j}}\nu\left(r\right)
\]

\end_inset


\end_layout

\begin_layout Subsubsection
Gradient Evaluation
\end_layout

\begin_layout Standard
(For Cartesian Coordinate system)
\end_layout

\begin_layout Standard
To approximate 
\begin_inset Formula $u$
\end_inset

 at 
\begin_inset Formula $r$
\end_inset

, first note the definition, if 
\begin_inset Formula $g$
\end_inset

, (assuming that 
\begin_inset Formula $\nu=\nu\left(r\right)$
\end_inset

)
\begin_inset Formula 
\begin{align*}
g\equiv\nabla\nu & =\partial\cdot v
\end{align*}

\end_inset

In Cartesian frame where 
\begin_inset Formula $r=\sum_{k}\rho_{k}e_{k}$
\end_inset

,
\begin_inset Formula 
\begin{align*}
g\equiv\nabla\nu & =\sum_{k}\frac{\partial\nu}{\partial\rho_{k}}e_{k}\\
 & =\sum_{k}\gamma_{k}e_{k}
\end{align*}

\end_inset

where the 
\begin_inset Formula $e_{k}$
\end_inset

 are basis vectors for (an assumed Cartesian) coordinate system in which
 the index of refraction field is defined.
\end_layout

\begin_layout Standard
The magnitude of this is
\begin_inset Formula 
\[
\left|g\right|=\sqrt{\sum\gamma_{k}^{2}}
\]

\end_inset

Thus,
\begin_inset Formula 
\[
u\equiv\frac{g}{\left|g\right|}=\frac{\sum_{k}\gamma_{k}e_{k}}{\sqrt{\sum\gamma_{k}^{2}}}
\]

\end_inset


\end_layout

\begin_layout Standard
The partial derivatives may be expressed as
\begin_inset Formula 
\[
\gamma_{k}=\lim_{\epsilon\rightarrow0}\left\{ \frac{n\left(r+\epsilon e_{k}\right)-n\left(r-\epsilon e_{k}\right)}{2\epsilon}\right\} 
\]

\end_inset

This may be approximated numerically as
\begin_inset Formula 
\[
\gamma_{k}\left(r\right)\simeq\frac{n\left(r+\epsilon e_{k}\right)-n\left(r-\epsilon e_{k}\right)}{2\epsilon}
\]

\end_inset

where 
\begin_inset Formula $\epsilon$
\end_inset

 is a sufficiently small numeric value (e.g.
 on the order of 
\begin_inset Formula $\left|r\right|\sqrt{\varepsilon}$
\end_inset

 for machine 
\begin_inset Quotes eld
\end_inset

epsilon
\begin_inset Quotes erd
\end_inset

 value, 
\begin_inset Formula $\varepsilon$
\end_inset

).
\end_layout

\begin_layout Subsubsection
Index of Refraction Evaluation
\end_layout

\begin_layout Standard
Determine the values, 
\begin_inset Formula $\nu_{i-1}$
\end_inset

 and 
\begin_inset Formula $\nu_{i+1}$
\end_inset

 based on some interval of path length 
\begin_inset Formula $\Delta_{\lambda,i}$
\end_inset

.
 This can be done by evaluating 
\begin_inset Formula $\nu$
\end_inset

 a short distance before 
\begin_inset Formula $r_{i}$
\end_inset

 and evaluating 
\begin_inset Formula $\nu_{i+1}$
\end_inset

 a short distance after 
\begin_inset Formula $r_{i}$
\end_inset

.
 E.g.
\begin_inset Formula 
\begin{align*}
\nu_{i-1} & =\nu\left(r_{i}-\frac{1}{2}\Delta_{\lambda,i}t_{i}\right)\\
\nu_{i+1} & =\nu\left(r_{i}+\frac{1}{2}\Delta_{\lambda,i}t_{i}\right)
\end{align*}

\end_inset

For this, the path length step, 
\begin_inset Formula $\Delta_{\lambda,i}$
\end_inset

, can be assigned arbitrarily or estimated from the prior points on path
 e.g.
\begin_inset Formula 
\[
\Delta_{\lambda,i}=\frac{1}{2}\left|r_{i}-r_{i-1}\right|
\]

\end_inset


\end_layout

\begin_layout Standard
In this spirit, a more general approach is to express index of refraction
 (IoR) values, for the neighboring intervals, in terms of the IoR gradient
 vector, 
\begin_inset Formula $g_{i}$
\end_inset

 and the displacement between adjacent nodes.
 E.g.
 the change in index can be approximated based on half the distance between
 the previous and the next location along ray.
\begin_inset Formula 
\begin{align*}
\nu_{i} & =\nu\left(r_{i}-g_{i}\cdot\frac{r_{i}-r_{i-1}}{2}\right)\\
\nu_{i+1} & =\nu\left(r_{i}+g_{i}\cdot\frac{r_{i+1}-r_{i}}{2}\right)
\end{align*}

\end_inset

Note that the use of a 
\begin_inset Quotes eld
\end_inset

future
\begin_inset Quotes erd
\end_inset

 position (
\begin_inset Formula $r_{i+1}$
\end_inset

) complicates evaluation of 
\begin_inset Formula $\nu_{i+1}$
\end_inset

.
 An iterative strategy for addressing this is presented below.
\end_layout

\begin_layout Subsection
Path Propagation Step
\end_layout

\begin_layout Standard
A complete ray path can be computed step by step using a forward propagation
 strategy described in this section.
 The method described here is essentially using Euler's method for solving
 the (as yet unspecified) differential equation system governing the ray
 path propagation.
 As such, it may be expected to share the same general characteristics -
 e.g.
 easy implementation, but relatively poor performance compared with higher
 order and more advanced methods.
\end_layout

\begin_layout Subsubsection
Notation
\end_layout

\begin_layout Standard
For both conceptual and bookkeeping clarity, introducing the following 
\begin_inset Quotes eld
\end_inset

per-step
\begin_inset Quotes erd
\end_inset

 concepts and subscript notation.
\end_layout

\begin_layout Description
\begin_inset Formula $c$
\end_inset

 Current (e.g.
 involving only the 
\begin_inset Formula $i$
\end_inset

-th node) - identify quantities that are associated with the IoR level surface
 at which refraction (or reflection) is being computed.
\end_layout

\begin_layout Description
\begin_inset Formula $p$
\end_inset

 Previous (e.g.
 involving nodes, 
\begin_inset Formula $i-1$
\end_inset

 and 
\begin_inset Formula $i$
\end_inset

) - identify quantities that are 
\begin_inset Quotes eld
\end_inset

before
\begin_inset Quotes erd
\end_inset

 the current IoR surface.
 E.g.
 a previous point on the ray, an index of refraction on the incident side
 of the current interface.
\end_layout

\begin_layout Description
\begin_inset Formula $n$
\end_inset

 Next (e.g.
 involving nodes, 
\begin_inset Formula $i$
\end_inset

 and 
\begin_inset Formula $i+1$
\end_inset

) - identify quantities that are 
\begin_inset Quotes eld
\end_inset

after
\begin_inset Quotes erd
\end_inset

 the current IoR surface.
 E.g.
 a next point on the ray, or the index of refraction associated with the
 exit side of the current interface.
\end_layout

\begin_layout Subsubsection
\begin_inset Quotes eld
\end_inset

Current
\begin_inset Quotes erd
\end_inset

 Step Configuration
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\begin_inset Graphics
	filename Refraction_InterfaceGeom.ipe
	width 100col%

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:Comparison-of-IoR-Models"

\end_inset

Comparison of index of refraction (IoR) models at the 
\begin_inset Formula $i$
\end_inset

-th node along the ray path.
 On the left, is the physical model that represents IoR as a scalar field
 which is defined continuously throughout space.
 On the right is the associated discontinuous interface model used for computing
 the refracted (or reflected) forward propagation direction during a single
 ray propagation step.
 The direction of the gradient in the continuous IoR field, 
\begin_inset Formula $g_{i}=\nabla\nu\left(r_{i}\right)$
\end_inset

, is associated with the normal direction of a flat plane in the interface
 model.
 The indices of refraction on each side of the interface are selected from
 the continuous field based on index values that are each half way between
 ray propagation nodes.
 The previous midpoint is easily computed during the forward ray propagation,
 while computing the next midpoint location is an iterative process.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset

For step-wise propagation computations, the continuously varying index of
 refraction field needs to be treated as a sequence of individual discrete
 boundaries.
 To do this, at each individual node in the ray path, assume an infinitesimally
 thin refractive (or reflective) interface boundary that passes through
 the 
\begin_inset Formula $i$
\end_inset

-th node's 
\begin_inset Quotes eld
\end_inset

current
\begin_inset Quotes erd
\end_inset

 location, 
\begin_inset Formula $r_{c}=r_{i}$
\end_inset

.
 In order to apply Snel's law, for computation purposes, the interface is
 treated as a geometrically sharp plane having an instantaneously discontinuous
 change in IoR as illustrated and described in Figure
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Comparison-of-IoR-Models"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
\end_layout

\begin_layout Paragraph
\begin_inset CommandInset label
LatexCommand label
name "par:Iterative-Estimation_nuNext"

\end_inset

Iterative Estimation of 
\begin_inset Quotes eld
\end_inset

Next
\begin_inset Quotes erd
\end_inset

 Refraction Index
\end_layout

\begin_layout Standard
At this discrete 
\begin_inset Quotes eld
\end_inset

current
\begin_inset Quotes erd
\end_inset

 interface, the previous index of refraction, 
\begin_inset Formula $\nu_{p}$
\end_inset

, may be determined as the IoR field value at the midpoint of the previous
 ray step.
 This is easy, since for the current propagation step, the previous node
 location, 
\begin_inset Formula $r_{p}$
\end_inset

 (e.g.
 same as 
\begin_inset Formula $r_{i-1}$
\end_inset

), is already known (as is the current location, 
\begin_inset Formula $r_{c}$
\end_inset

).
 However, computing the next IoR value, 
\begin_inset Formula $\nu_{n}$
\end_inset

, is more difficult since the next node location, 
\begin_inset Formula $r_{n}$
\end_inset

 (e.g.
 
\begin_inset Formula $r_{i+1}$
\end_inset

) is yet to be determined.
\end_layout

\begin_layout Standard
Estimating the next IoR value, 
\begin_inset Formula $\nu_{n}$
\end_inset

, can be performed iteratively as follows:
\end_layout

\begin_layout Enumerate
Introduce a temporary location that will evolve over each iteration.
 Denote this location as vector, 
\begin_inset Formula $q_{n,j}$
\end_inset

, with the subscript, 
\begin_inset Formula $n$
\end_inset

, indicating this is a location at which to evaluate the 
\begin_inset Quotes eld
\end_inset

next
\begin_inset Quotes erd
\end_inset

 index of refraction, and the subscript, 
\begin_inset Formula $j=0,1,\dots$
\end_inset

, tracking the iterative process described here.
\end_layout

\begin_layout Enumerate
As an initial estimate of the next evaluation location, 
\begin_inset Formula $q_{n,j=0}$
\end_inset

, compute a location symmetric with the previous node via
\begin_inset Formula 
\[
q_{n,0}=r_{c}+\frac{1}{2}\left(r_{c}-r_{p}\right)
\]

\end_inset

Noting that the iteration index here is 
\begin_inset Formula $j=0$
\end_inset

.
\end_layout

\begin_layout Enumerate
\begin_inset CommandInset label
LatexCommand label
name "enu:Sample-the-IoR"

\end_inset

Sample the IoR field, 
\begin_inset Formula $\nu\left(r\right)$
\end_inset

, based on the 
\begin_inset Formula $j$
\end_inset

-th estimate of the next evaluation location.
 I.e.
\begin_inset Formula 
\[
\nu_{n,j}=\nu\left(q_{n,j}\right)
\]

\end_inset


\end_layout

\begin_layout Enumerate
Use this initial IoR estimate, 
\begin_inset Formula $\nu_{n,0}$
\end_inset

, to propagate the ray forward in order to estimate the next tangent direction,
 
\begin_inset Formula $t_{n,j}$
\end_inset

, (using relationships and formula presented below in section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Tangent-Direction-Update"
plural "false"
caps "false"
noprefix "false"

\end_inset

).
 I.e.
 evaluate the functional form
\begin_inset Formula 
\[
t_{n,j}=t\left(t_{p},\nu_{p},g_{c},\nu_{n,j}\right)
\]

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset CommandInset label
LatexCommand label
name "enu:Update-the-next-node"

\end_inset

Update the next evaluation location using the estimated tangent direction
 while respecting two distinct cases:
\end_layout

\begin_deeper
\begin_layout Enumerate
If the estimated tangent, and gradient are mostly in the same direction,
 i.e.
 
\begin_inset Formula $0<t_{n,j}\cdot g_{c}$
\end_inset

, the new estimated tangent direction represents refraction.
 In this case (transmission) the estimated next evaluation position in terms
 of the forward ray direction via
\begin_inset Formula 
\[
q_{n,j+1}=r_{c}+\frac{1}{2}\left|r_{c}-r_{p}\right|t_{n,j}\,;\,0<t_{n,j}\cdot g_{c}
\]

\end_inset


\end_layout

\begin_layout Enumerate
If the estimated tangent, and gradient are mostly in opposing directions,
 i.e.
 
\begin_inset Formula $t_{n,j}\cdot g_{c}\le0$
\end_inset

, the new estimated tangent direction represents a total internal reflection.
 In this case (reflection), estimate the next evaluation position in terms
 of the interface gradient direction via
\begin_inset Formula 
\[
q_{n,j+1}=r_{c}+\frac{1}{2}\left|r_{c}-r_{p}\right|g_{c}\,;\,t_{n,j}\cdot g_{c}\le0
\]

\end_inset


\end_layout

\end_deeper
\begin_layout Enumerate
Iteratively, use this new evaluation location to obtain the updated next
 IoR value, 
\begin_inset Formula $\nu_{n,j+1}$
\end_inset

, the updated next tangent direction, 
\begin_inset Formula $t_{n,j+1}$
\end_inset

, and the updated next evaluation location, 
\begin_inset Formula $q_{n,j+2}$
\end_inset

 by repeating steps
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "enu:Sample-the-IoR"
plural "false"
caps "false"
noprefix "false"

\end_inset

 through
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "enu:Update-the-next-node"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
 Terminate the iterative process when the sequence of 
\begin_inset Formula $r_{n,j+1}$
\end_inset

 values converges e.g.
 when
\begin_inset Formula 
\[
\left|r_{n,j+1}-r_{n,j}\right|<\varepsilon
\]

\end_inset

for some appropriately small scalar value, 
\begin_inset Formula $\varepsilon$
\end_inset

.
\end_layout

\begin_deeper
\begin_layout Enumerate
TODO/TBD - It is not obvious if there is a formal justification if this
 should converge.
 It seems to work in software code, but...??
\end_layout

\end_deeper
\begin_layout Enumerate
At convergence:
\end_layout

\begin_deeper
\begin_layout Enumerate
For transmission case, the estimated evaluation location, 
\begin_inset Formula $q_{n,j+1}$
\end_inset

, is half way toward the estimated next node location which may be computed
 immediately as
\begin_inset Formula 
\[
r_{n}=r_{c}+2\left(q_{n,j+1}-r_{c}\right)=2q_{n,j+1}-r_{c}
\]

\end_inset


\end_layout

\begin_layout Enumerate
For reflection case, the estimated evaluation location has no direct reuse,
 and the next node location needs to be computed by explicit forward propagation
 of the (reflected) tangent direction.
\end_layout

\end_deeper
\begin_layout Subsubsection
\begin_inset CommandInset label
LatexCommand label
name "subsec:Tangent-Direction-Update"

\end_inset

Tangent Direction Update
\end_layout

\begin_layout Standard
Updating the ray path tangent vector may be expressed by the following functiona
l form
\begin_inset Formula 
\[
t_{n}=t\left(t_{p},\nu_{p},g_{c},\nu_{n}\right)
\]

\end_inset

This assumes the next IoR value, 
\begin_inset Formula $\nu_{n}$
\end_inset

, actually used for tangent evaluation has been computed using the iterative
 estimation process described above.
\end_layout

\begin_layout Paragraph
Snel's Law
\begin_inset Foot
status open

\begin_layout Plain Layout
Snel's name may be spelled with either one 
\begin_inset Quotes eld
\end_inset

l
\begin_inset Quotes erd
\end_inset

 or with two - e.g.
 https://en.wikipedia.org/wiki/Willebrord_Snellius.
 It seems his actual name is Snel, but that he used the Latinized version,
 
\begin_inset Quotes eld
\end_inset

Snellius
\begin_inset Quotes erd
\end_inset

 in many publications (TODO/cite).
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The next tangent direction, 
\begin_inset Formula $t_{n}$
\end_inset

, satisfies Snel's law in the context of the previous tangent direction,
 
\begin_inset Formula $t_{p}$
\end_inset

, the previous index of refraction, 
\begin_inset Formula $\nu_{p}$
\end_inset

, and the (estimated) next index of refraction, 
\begin_inset Formula $\nu_{n}$
\end_inset

.
 This interaction occurs at the current interface having IoR gradient, 
\begin_inset Formula $g_{c}$
\end_inset

, and may be expressed in geometric algebra form as
\begin_inset Formula 
\[
\nu_{p}\left(t_{p}\wedge g_{c}\right)=\nu_{n}\left(t_{n}\wedge g_{c}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
Note that Snel's law as expressed here implicitly assumes that 
\begin_inset Formula $\left|t_{p}\right|=\left|t_{n}\right|$
\end_inset

.
 This is required so that the ratio of magnitudes of the two outer products
 is the same as the ratio of the sines of the entrance and exit angles as
 specified in Snel's classic relationship.
 Since this is a homogeneous relationship in the (equal) magnitude of the
 tangent vectors, that magnitude can be set to unity, i.e.
 
\begin_inset Formula $\left|t_{p}\right|=\left|t_{n}\right|=1$
\end_inset

, without loss of generality.
 This condition of the magnitude of the tangent vectors, will be used further
 below.
\end_layout

\begin_layout Standard
The left and right sides of this refraction equation are bivectors that
 are equal.
 Denote this common value as, 
\begin_inset Formula $B$
\end_inset

, such that the above equality may be expressed as the two equations
\begin_inset Formula 
\begin{equation}
\nu_{p}\left(\hat{t}_{p}\wedge g_{c}\right)=B\label{eq:defB_prev}
\end{equation}

\end_inset

 and
\begin_inset Formula 
\begin{equation}
\nu_{n}\left(\hat{t}_{n}\wedge g_{c}\right)=B\label{eq:defB_next}
\end{equation}

\end_inset

where the 
\begin_inset Quotes eld
\end_inset

hat
\begin_inset Quotes erd
\end_inset

 notation indicates unit magnitude tangent vectors are assumed in the definition
 and interpretation of bivector, 
\begin_inset Formula $B$
\end_inset

.
\end_layout

\begin_layout Paragraph
Complementary Boundary Constituent
\end_layout

\begin_layout Standard
Consider the exiting portion of the ray path and note that the dot product
 of 
\begin_inset Formula $t_{n}$
\end_inset

 and 
\begin_inset Formula $g_{c}$
\end_inset

 is some unknown scalar value.
 Denote this unknown value by the scalar variable, 
\begin_inset Formula $\lambda_{n}$
\end_inset

, that satisfies the relationship
\begin_inset Formula 
\[
\nu_{n}t_{n}\cdot g_{c}=\lambda_{n}
\]

\end_inset

Since the index of refraction, 
\begin_inset Formula $\nu_{n}$
\end_inset

 is always positive, the sign of 
\begin_inset Formula $\lambda_{n}$
\end_inset

 is positive if 
\begin_inset Formula $t_{n}$
\end_inset

 is nominally aligned with 
\begin_inset Formula $g_{c}$
\end_inset

, and is negative if 
\begin_inset Formula $t_{n}$
\end_inset

 is nominally anti-aligned with the IoR gradient, 
\begin_inset Formula $g_{c}$
\end_inset

.
 I.e.
\end_layout

\begin_layout Itemize
The condition, 
\begin_inset Formula $0<\lambda_{n}$
\end_inset

, when the tangent and the gradient are mostly aligned, corresponds with
 refraction into an increasingly dense next medium for which 
\begin_inset Formula $\nu_{p}<\nu_{n}$
\end_inset


\end_layout

\begin_layout Itemize
The condition, 
\begin_inset Formula $\lambda_{n}<0$
\end_inset

, when the tangent and gradient are oppositely directed, corresponds with
 refraction into an increasingly sparse next medium for which 
\begin_inset Formula $\nu_{n}<\nu_{p}$
\end_inset


\end_layout

\begin_layout Itemize
The condition, 
\begin_inset Formula $\lambda_{n}=0$
\end_inset

, is associated with a special case.
 This corresponds with a ray tangent direction that is orthogonal to the
 IoR gradient, 
\begin_inset Formula $g_{c}$
\end_inset

.
 In this case, the exiting ray should bend into the optically denser medium
 at the critical angle associated the ratio of IoR values.
\end_layout

\begin_layout Paragraph
Geometric Form
\end_layout

\begin_layout Standard
Add the dot product relationship to the first equation above to obtain the
 (spinor-valued) relationship,
\begin_inset Formula 
\[
\nu_{n}\left(t_{n}\wedge g_{c}\right)+\nu_{n}\left(t_{n}\cdot g_{c}\right)=B+\lambda_{n}
\]

\end_inset

which may be expressed in terms of the geometric product as
\begin_inset Formula 
\begin{equation}
\nu_{n}t_{n}g_{c}=B+\lambda_{n}\label{eq:ntgNext_GA}
\end{equation}

\end_inset

Multiply each side by its own reverse (viz.
 
\begin_inset Formula $g_{c}t_{n}\nu_{n}=-B+\lambda$
\end_inset

), thereby forming the squared magnitude relationship,
\begin_inset Formula 
\[
\nu_{n}^{2}t_{n}^{2}g_{c}^{2}=\lambda_{n}^{2}-B^{2}
\]

\end_inset


\end_layout

\begin_layout Standard
Enforcing the condition that 
\begin_inset Formula $t_{n}^{2}=1$
\end_inset

, solve for 
\begin_inset Formula $\lambda_{n}$
\end_inset


\begin_inset Formula 
\[
\lambda_{n}=\pm\sqrt{\nu_{n}^{2}g_{c}^{2}+B^{2}}
\]

\end_inset

The sign is selected consistent with the conditions noted above.
 I.e.
\begin_inset Formula 
\[
\lambda_{n}=\begin{cases}
+\sqrt{\nu_{n}^{2}g_{c}^{2}+B^{2}} & \nu_{p}<\nu_{n}\\
-\sqrt{\nu_{n}^{2}g_{c}^{2}+B^{2}} & \nu_{n}<\nu_{p}
\end{cases}
\]

\end_inset


\end_layout

\begin_layout Paragraph
Next Tangent Direction
\end_layout

\begin_layout Standard
Substitute this solution into expression
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:ntgNext_GA"
plural "false"
caps "false"
noprefix "false"

\end_inset

 to obtain
\begin_inset Formula 
\[
\nu_{n}\hat{t}_{n}g_{c}=B\pm\sqrt{\nu_{n}^{2}g_{c}^{2}+B^{2}}
\]

\end_inset

The 
\begin_inset Quotes eld
\end_inset

hat
\begin_inset Quotes erd
\end_inset

 notation on 
\begin_inset Formula $\hat{t}_{n}$
\end_inset

 has been introduced as a reminder that this relationship only applies for
 unit magnitude tangent vectors as has been enforced in developing this
 relationship.
 Since the index of refraction, 
\begin_inset Formula $\nu_{n}$
\end_inset

, is strictly positive (actually strictly greater than or equal to one),
 this relationship may also be expressed as
\begin_inset Formula 
\[
\hat{t}_{n}g_{c}=\nu_{n}^{-1}B\pm\nu_{n}^{-1}\sqrt{\nu_{n}^{2}g_{c}^{2}+B^{2}}
\]

\end_inset


\end_layout

\begin_layout Standard
If the gradient is non zero, 
\begin_inset Formula $g_{c}\ne0$
\end_inset

, the next tangent direction, 
\begin_inset Formula $\hat{t}_{n}$
\end_inset

, may be expressed explicitly as
\begin_inset Formula 
\[
\hat{t}_{n}=\begin{cases}
\nu_{n}^{-1}\left[B+\sqrt{\nu_{n}^{2}g_{c}^{2}+B^{2}}\right]g_{c}^{-1} & g_{c}\ne0,\,\nu_{p}<\nu_{n}\\
\nu_{n}^{-1}\left[B-\sqrt{\nu_{n}^{2}g_{c}^{2}+B^{2}}\right]g_{c}^{-1} & g\ne0,\,\nu_{n}<\nu_{p}\\
\hat{t}_{p} & g_{c}=0,\,\nu_{n}=\nu_{p}
\end{cases}
\]

\end_inset

The last relationship follows form the simple observation that, if there
 is no gradient to the IoR field, then the ray does not change direction
 at this interface boundary.
\end_layout

\begin_layout Standard
Since this tangent direction relationship has been derived considering the
 
\begin_inset Quotes eld
\end_inset

next
\begin_inset Quotes erd
\end_inset

 side of the interface boundary, equation
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:defB_prev"
plural "false"
caps "false"
noprefix "false"

\end_inset

 may be used to substitute 
\begin_inset Quotes eld
\end_inset

previous
\begin_inset Quotes erd
\end_inset

 values defining 
\begin_inset Formula $B$
\end_inset

, as 
\begin_inset Formula $B=\nu_{p}\left(t_{p}\wedge g_{c}\right)$
\end_inset

, in order to express the geometric relationship as
\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
using
\begin_inset Formula 
\[
\nu_{p}\left(t_{p}\wedge g_{c}\right)=B
\]

\end_inset

to get
\begin_inset Formula 
\[
\hat{t}_{n}g_{c}=\nu_{n}^{-1}\nu_{p}\left(t_{p}\wedge g_{c}\right)\pm\nu_{n}^{-1}\sqrt{\nu_{n}^{2}g_{c}^{2}+\left(\nu_{p}\left(t_{p}\wedge g_{c}\right)\right)^{2}}
\]

\end_inset


\begin_inset Formula 
\[
\hat{t}_{n}g_{c}=\nu_{n}^{-1}\nu_{p}\left(t_{p}\wedge g_{c}\right)\pm\sqrt{\nu_{n}^{-2}\nu_{n}^{2}g_{c}^{2}+\nu_{n}^{-2}\left(\nu_{p}\left(t_{p}\wedge g_{c}\right)\right)^{2}}
\]

\end_inset

or
\end_layout

\end_inset


\begin_inset Formula 
\[
\hat{t}_{n}g_{c}=\frac{\nu_{p}}{\nu_{n}}\left(t_{p}\wedge g_{c}\right)\pm\sqrt{g_{c}^{2}+\left(\frac{\nu_{p}}{\nu_{n}}\right)^{2}\left(t_{p}\wedge g_{c}\right)^{2}}
\]

\end_inset

for which the next tangent direction may be computed explicitly in terms
 of the boundary information, 
\begin_inset Formula $g_{c}$
\end_inset

, 
\begin_inset Formula $\nu_{p}$
\end_inset

, 
\begin_inset Formula $\nu_{n}$
\end_inset

, and incident ray direction, 
\begin_inset Formula $t_{p}$
\end_inset

, as
\begin_inset Formula 
\[
\hat{t}_{n}=\begin{cases}
\left[\frac{\nu_{p}}{\nu_{n}}\left(t_{p}\wedge g_{c}\right)+\sqrt{g_{c}^{2}+\left(\frac{\nu_{p}}{\nu_{n}}\right)^{2}\left(t_{p}\wedge g_{c}\right)^{2}}\right]g_{c}^{-1} & g_{c}\ne0,\,\nu_{p}<\nu_{n}\\
\left[\frac{\nu_{p}}{\nu_{n}}\left(t_{p}\wedge g_{c}\right)-\sqrt{g_{c}^{2}+\left(\frac{\nu_{p}}{\nu_{n}}\right)^{2}\left(t_{p}\wedge g_{c}\right)^{2}}\right]g_{c}^{-1} & g_{c}\ne0,\,\nu_{n}<\nu_{p}\\
\hat{t}_{p} & g_{c}=0,\,\nu_{n}=\nu_{p}
\end{cases}
\]

\end_inset

Note that, potentially surprisingly, the two refraction solutions are independen
t of the magnitude of the gradient, 
\begin_inset Formula $\left|g_{c}\right|$
\end_inset

, such that any magnitude gradient will provide the same solution.
 This can be understood by considering the following:
\end_layout

\begin_layout Itemize
The index of refraction values, 
\begin_inset Formula $\nu_{p}$
\end_inset

 and 
\begin_inset Formula $\nu_{n}$
\end_inset

, are associated with locations within the overall IoR scalar field that
 are spatially removed from the boundary at which the refraction is being
 evaluated (by about half a ray propagation step size - cf.
 Figure
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Comparison-of-IoR-Models"
plural "false"
caps "false"
noprefix "false"

\end_inset

).
\end_layout

\begin_layout Itemize
Since the change for index of refraction is already represented by the scalar
 values, 
\begin_inset Formula $\nu_{p}$
\end_inset

 and 
\begin_inset Formula $\nu_{n}$
\end_inset

, only the direction of the gradient vector is important for representing
 the direction of the (locally) planar discrete interface boundary (at the
 current propagation node).
\end_layout

\begin_layout Itemize
If the magnitude of the gradient vector were significant, that would represent
 a coupling of concepts between boundary direction and IoR value changes
 (contrary to formulation and assumptions used for developing this relationship).
\end_layout

\begin_layout Paragraph
Total Internal Reflection
\end_layout

\begin_layout Standard
In the preceding solution for 
\begin_inset Quotes eld
\end_inset

next
\begin_inset Quotes erd
\end_inset

 tangent vector, 
\begin_inset Formula $\hat{t}_{n}$
\end_inset

, the square root operation assumes that the scalar valued radicand is positive.
 I.e.
 that
\begin_inset Formula 
\[
0\le g_{c}^{2}+\left(\frac{\nu_{p}}{\nu_{n}}\right)^{2}\left(t_{p}\wedge g_{c}\right)^{2}
\]

\end_inset


\end_layout

\begin_layout Standard
The first term on the left is always positive (since the relevant cases
 are for 
\begin_inset Formula $g_{c}\ne0$
\end_inset

).
 However, the second term on the right is always negative.
 This is because the (squared) ratio of IoR values is always positive while
 the squared bivector factor is always non positive.
 Thus, at some angle of incidence (known as the 
\begin_inset Quotes eld
\end_inset

critical angle
\begin_inset Quotes erd
\end_inset

) the magnitude of the bivector factor becomes large enough such that the
 radicand becomes negative.
 I.e.
 such that
\begin_inset Formula 
\[
g_{c}^{2}-\left(\frac{\nu_{p}}{\nu_{n}}\right)^{2}\left|t_{p}\wedge g_{c}\right|^{2}<0
\]

\end_inset


\end_layout

\begin_layout Standard
For the case of total internal reflection (or for reflection in general),
 it is necessary that 
\begin_inset Formula $g_{c}\ne0$
\end_inset

 (otherwise, the radicand is identically zero and there is no refraction
 nor reflection).
\end_layout

\begin_layout Standard
TODO/TBD - if the radicand is zero, then the resulting 
\begin_inset Formula $\hat{t}_{n}$
\end_inset

 is directed orthogonal to the gradient, 
\begin_inset Formula $g_{c}$
\end_inset

.
\begin_inset Note Comment
status open

\begin_layout Plain Layout
Since
\begin_inset Formula 
\[
\hat{t}_{n}=\begin{cases}
\left[\frac{\nu_{p}}{\nu_{n}}\left(t_{p}\wedge g_{c}\right)\right]g_{c}^{-1} & g_{c}\ne0,\,\nu_{p}<\nu_{n}\\
\left[\frac{\nu_{p}}{\nu_{n}}\left(t_{p}\wedge g_{c}\right)\right]g_{c}^{-1} & g_{c}\ne0,\,\nu_{n}<\nu_{p}\\
\hat{t}_{p} & g_{c}=0,\,\nu_{n}=\nu_{p}
\end{cases}
\]

\end_inset

and the bivector, 
\begin_inset Formula $\hat{t}_{p}\wedge g_{c}$
\end_inset

 turns the vector, 
\begin_inset Formula $g_{c}^{-1}$
\end_inset

 a quarter turn (then scaled it by 
\begin_inset Formula $\nu_{p}\nu_{n}^{-1}$
\end_inset

).
\end_layout

\end_inset


\end_layout

\begin_layout Standard
For reflection, the direction of the reflected ray, 
\begin_inset Formula $\hat{t}_{n}$
\end_inset

, may be expressed by algebraically reflecting the direction of the incident
 ray, 
\begin_inset Formula $\hat{t}_{p}$
\end_inset

, through the plane perpendicular to the IoR gradient.
 This may be expressed algebraically as
\begin_inset Formula 
\[
\left(\hat{t}_{n}=-g_{c}\hat{t}_{p}g_{c}^{-1}\right)\iff\left(g_{c}^{2}+\left(\frac{\nu_{p}}{\nu_{n}}\right)^{2}\left(t_{p}\wedge g_{c}\right)^{2}<0\right)
\]

\end_inset


\begin_inset Note Comment
status collapsed

\begin_layout Paragraph
Bivector Root Approach
\end_layout

\begin_layout Plain Layout
If this is not the case, then the radicand can be expressed as
\begin_inset Formula 
\[
\nu_{n}^{2}g_{c}^{2}+B^{2}=-\left|\nu_{n}^{2}g_{c}^{2}+B^{2}\right|
\]

\end_inset

so that
\begin_inset Formula 
\[
\sqrt{\nu_{n}^{2}g_{c}^{2}+B^{2}}=\sqrt{-\left|\nu_{n}^{2}g_{c}^{2}+B^{2}\right|}=\sqrt{-1}\sqrt{\left|\nu_{n}^{2}g_{c}^{2}+B^{2}\right|}
\]

\end_inset


\end_layout

\begin_layout Plain Layout
For the present case, a convenient root of negative one is provided by the
 unitary direction of bivector, 
\begin_inset Formula $B$
\end_inset

, i.e.
 via
\begin_inset Formula 
\[
\hat{B}^{2}=-1
\]

\end_inset

for
\begin_inset Formula 
\[
\hat{B}=\frac{B}{\left|B\right|}=\frac{B}{\sqrt{-B^{2}}}
\]

\end_inset

so that
\begin_inset Formula 
\[
\sqrt{\nu_{n}^{2}g_{c}^{2}+B^{2}}=\hat{B}\sqrt{\left|\nu_{n}^{2}g_{c}^{2}+B^{2}\right|}
\]

\end_inset


\end_layout

\begin_layout Plain Layout
TODO/TBD - demonstrate (if) this is equivalent to law of refraction (which
 probably it is? maybe??)
\end_layout

\end_inset


\end_layout

\begin_layout Paragraph
Summary
\end_layout

\begin_layout Standard
The above results my be summarized by expressing the 
\begin_inset Quotes eld
\end_inset

next
\begin_inset Quotes erd
\end_inset

 tangent direction solution as the sequence of computations
\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
\begin_inset Formula 
\begin{align*}
B & =\frac{\nu_{p}}{\nu_{n}}\left(t_{p}\wedge g_{c}\right)\\
\xi & \equiv g_{c}^{2}+B^{2}\\
\hat{t}_{n} & =\begin{cases}
\hat{t}_{p} & g_{c}=0,\,\nu_{n}=\nu_{p}\\
-g_{c}\hat{t}_{p}g_{c}^{-1} & g_{c}\ne0,\,\nu_{p}<\nu_{n},\,\xi<0\\
\left[\frac{\nu_{p}}{\nu_{n}}\left(t_{p}\wedge g_{c}\right)+\sqrt{\xi}\right]g_{c}^{-1} & g_{c}\ne0,\,\nu_{p}<\nu_{n},\,0\le\xi\\
\left[\frac{\nu_{p}}{\nu_{n}}\left(t_{p}\wedge g_{c}\right)-\sqrt{\xi}\right]g_{c}^{-1} & g_{c}\ne0,\,\nu_{n}<\nu_{p},\,0\le\xi
\end{cases}
\end{align*}

\end_inset


\end_layout

\end_inset


\begin_inset Formula 
\[
g_{c}=\nabla\nu
\]

\end_inset


\begin_inset Formula 
\[
B=\frac{\nu_{p}}{\nu_{n}}\left(\hat{t}_{p}\wedge g_{c}\right)
\]

\end_inset


\begin_inset Formula 
\[
\xi\equiv g_{c}^{2}+B^{2}
\]

\end_inset


\begin_inset Formula 
\[
\hat{t}_{n}=\begin{cases}
\hat{t}_{p} & g_{c}=0,\,\nu_{n}=\nu_{p}\\
-g_{c}\hat{t}_{p}g_{c}^{-1} & g_{c}\ne0,\,\nu_{p}<\nu_{n},\,\xi<0\\
\left(B+\sqrt{\xi}\right)g_{c}^{-1} & g_{c}\ne0,\,\nu_{p}<\nu_{n},\,0\le\xi\\
\left(B-\sqrt{\xi}\right)g_{c}^{-1} & g_{c}\ne0,\,\nu_{n}<\nu_{p},\,0\le\xi
\end{cases}
\]

\end_inset

Note that, during forward ray path propagation, the 
\begin_inset Quotes eld
\end_inset

future
\begin_inset Quotes erd
\end_inset

 value, 
\begin_inset Formula $\nu_{n}$
\end_inset

, must be estimated as part of an iterative process as described in paragraph
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "par:Iterative-Estimation_nuNext"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
\end_layout

\begin_layout Section
Atmosphere Model Example
\end_layout

\begin_layout Standard
Consider if the index of refraction (IoR) field, 
\begin_inset Formula $\nu$
\end_inset

, is an exponential function of distance from a center of spherical symmetry
\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
(TODO/TBD - or might use spherical polar coordinate system - along with
 updated expression for the gradient, but in any case...).
\end_layout

\end_inset

 I.e.
 let 
\begin_inset Formula 
\[
\nu=\alpha e^{-\beta\left|r\right|}
\]

\end_inset


\end_layout

\begin_layout Subsection
Gradient
\end_layout

\begin_layout Standard
The IoR field may be expressed with respect to a Cartesian coordinate system
 as
\begin_inset Formula 
\[
\nu=\alpha\exp\left(-\beta\sqrt{\rho_{1}^{2}+\rho_{2}^{2}+\rho_{3}^{2}}\right)
\]

\end_inset

In this Cartesian frame, the gradient is easily computed as
\begin_inset Formula 
\begin{align*}
g=\nabla\nu=\sum_{k}\partial_{k}\nu & =\sum\alpha\exp\left(-\beta\left|r\right|\right)\left(-\beta\frac{1}{2}\frac{1}{\left|r\right|}2\rho_{k}\right)e_{k}\\
 & =-\alpha\beta\frac{e^{-\beta\left|r\right|}}{\left|r\right|}\sum\rho_{k}e_{k}\\
 & =-\alpha\beta\frac{e^{-\beta\left|r\right|}}{\left|r\right|}r
\end{align*}

\end_inset

Although a Cartesian frame was assumed to demonstrate computation of the
 gradient, the resulting expression on the last line is coordinate system
 independent, so that, in general
\begin_inset Formula 
\begin{align*}
g=\nabla\nu & =-\alpha\beta\nu\frac{r}{\left|r\right|}\\
 & =-\alpha\beta\nu\hat{r}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
The associated (coordinate system independent) gradient magnitude is
\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
\begin_inset Formula 
\begin{align*}
\left|g\right|=\sqrt{g^{2}} & =\sqrt{\left(-\frac{\alpha\beta}{\left|r\right|}\nu\sum\rho_{k}e_{k}\right)\left(-\frac{\alpha\beta}{\left|r\right|}\nu\sum\rho_{k}e_{k}\right)}\\
 & =\frac{\alpha\beta}{\left|r\right|}\nu\sqrt{\left(\sum\rho_{k}e_{k}\right)\left(\sum\rho_{k}e_{k}\right)}\\
 & =\frac{\alpha\beta}{\left|r\right|}\nu\sqrt{rr}\\
 & =\frac{\alpha\beta}{\left|r\right|}\nu\left|r\right|\\
 & =\alpha\beta\nu
\end{align*}

\end_inset


\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
\left|g\right|=\sqrt{g^{2}} & =\sqrt{\left(-\alpha\beta\nu\hat{r}\right)\left(-\alpha\beta\nu\hat{r}\right)}\\
 & =\alpha\beta\nu\sqrt{\hat{r}^{2}}\\
 & =\alpha\beta\nu
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
The associated (coordinate system independent) gradient unit direction is
\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
\begin_inset Formula 
\begin{align*}
u=\frac{g}{\left|g\right|} & =\frac{-\frac{\alpha\beta}{\left|r\right|}\nu\sum\rho_{k}e_{k}}{\sqrt{\left(-\frac{\alpha\beta}{\left|r\right|}\nu\sum\rho_{k}e_{k}\right)^{2}}}\\
 & =\frac{-\sum\rho_{k}e_{k}}{\sqrt{\left(\sum\rho_{k}e_{k}\right)^{2}}}\\
 & =\frac{-r}{\left|r\right|}\\
 & =-\hat{r}
\end{align*}

\end_inset


\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
u=\frac{g}{\left|g\right|} & =\frac{-\alpha\beta\nu\hat{r}}{\alpha\beta\nu}\\
 & =-\hat{r}
\end{align*}

\end_inset

I.e.
 for the radially symmetric index of refraction field (decreasing with distance
 from center), the gradient is aligned radially inward as expected.
\end_layout

\begin_layout Subsection
Determining the Exponential Model Parameters
\end_layout

\begin_layout Standard
Assume a (radially symmetric) exponential atmospheric index of refraction
 model of the form
\begin_inset Formula 
\[
\nu\left(r\right)=\alpha e^{-\beta\left|r\right|}=e^{\ln\alpha-\beta\left|r\right|}
\]

\end_inset

along with known/desired boundary conditions
\begin_inset Formula 
\begin{align*}
\nu\left(r=r_{0}\right) & =\nu_{0}\\
\nu\left(r=r_{1}\right) & =\nu_{1}
\end{align*}

\end_inset

for which it is desired to determine values for the free parameters, 
\begin_inset Formula $\alpha$
\end_inset

 and 
\begin_inset Formula $\beta$
\end_inset

.
\end_layout

\begin_layout Subsubsection
Boundary Conditions
\end_layout

\begin_layout Standard
Utilize the boundary conditions to form a pair of simultaneous equations,
\begin_inset Formula 
\[
\alpha e^{-\beta\sqrt{r_{0}^{2}}}=\nu_{0}
\]

\end_inset


\begin_inset Formula 
\[
\alpha e^{-\beta\sqrt{r_{1}^{2}}}=\nu_{1}
\]

\end_inset

the solution of which provides the desired model parameter values.
\end_layout

\begin_layout Subsubsection
Solution Approach
\end_layout

\begin_layout Standard
To develop a solution, divide the first equation by the second to obtain
\begin_inset Formula 
\[
e^{\beta\left(\sqrt{r_{1}^{2}}-\sqrt{r_{0}^{2}}\right)}=\frac{\nu_{0}}{\nu_{1}}
\]

\end_inset

At this point, taking logarithms of both sides, allows solving for 
\begin_inset Formula $\beta$
\end_inset

, assuming 
\begin_inset Formula $\left|r_{1}\right|\ne\left|r_{0}\right|$
\end_inset

, via
\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
\begin_inset Formula 
\[
\beta=\left(\ln\frac{\nu_{0}}{\nu_{1}}\right)\left(\sqrt{r_{1}^{2}}-\sqrt{r_{0}^{2}}\right)^{-1}
\]

\end_inset


\end_layout

\end_inset


\begin_inset Formula 
\[
\beta=\frac{\ln\nu_{0}-\ln\nu_{1}}{\sqrt{r_{1}^{2}}-\sqrt{r_{0}^{2}}}
\]

\end_inset

To determine complete the solution, insert this expression for 
\begin_inset Formula $\beta$
\end_inset

 into either of the boundary conditions to determine for 
\begin_inset Formula $\alpha$
\end_inset

.
 I.e.
\begin_inset Formula 
\[
\alpha=\nu_{0}\exp\left(\beta\sqrt{r_{0}^{2}}\right)=\nu_{0}\exp\left(\frac{\ln\nu_{0}-\ln\nu_{1}}{\sqrt{r_{1}^{2}}-\sqrt{r_{0}^{2}}}\sqrt{r_{0}^{2}}\right)
\]

\end_inset

or
\begin_inset Formula 
\[
\alpha=\nu_{1}\exp\left(\beta\sqrt{r_{1}^{2}}\right)=\nu_{1}\exp\left(\frac{\ln\nu_{0}-\ln\nu_{1}}{\sqrt{r_{1}^{2}}-\sqrt{r_{0}^{2}}}\sqrt{r_{1}^{2}}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
The two solutions for 
\begin_inset Formula $\alpha$
\end_inset

 may also be expressed
\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
as
\begin_inset Formula 
\[
\alpha=\nu_{0}\exp\left(\ln\frac{\nu_{0}}{\nu_{1}}\frac{\left|r_{0}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\right)
\]

\end_inset


\begin_inset Formula 
\[
\alpha=\nu_{1}\exp\left(\ln\frac{\nu_{0}}{\nu_{1}}\frac{\left|r_{1}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\right)
\]

\end_inset

or,
\end_layout

\end_inset

 in terms of 
\begin_inset Formula $\ln\alpha$
\end_inset

, as
\begin_inset Formula 
\[
\ln\alpha=\ln\nu_{0}+\frac{\left|r_{0}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\ln\frac{\nu_{0}}{\nu_{1}}
\]

\end_inset


\begin_inset Formula 
\[
\ln\alpha=\ln\nu_{1}+\frac{\left|r_{1}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\ln\frac{\nu_{0}}{\nu_{1}}
\]

\end_inset


\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
Or as
\begin_inset Formula 
\begin{align*}
\ln\alpha & =\ln\nu_{0}+\frac{\left|r_{0}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\ln\nu_{0}-\frac{\left|r_{0}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\ln\nu_{1}\\
 & =\left(1+\frac{\left|r_{0}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\right)\ln\nu_{0}-\frac{\left|r_{0}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\ln\nu_{1}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
\ln\alpha & =\left(1+\frac{\left|r_{0}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\right)\ln\nu_{0}-\left(\frac{\left|r_{0}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\right)\ln\nu_{1}
\end{align*}

\end_inset

and
\begin_inset Formula 
\begin{align*}
\ln\alpha & =\ln\nu_{1}+\frac{\left|r_{1}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\ln\nu_{0}-\frac{\left|r_{1}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\ln\nu_{1}\\
 & =\frac{\left|r_{1}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\ln\nu_{0}+\left(1-\frac{\left|r_{1}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\right)\ln\nu_{1}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
\ln\alpha & =\left(\frac{\left|r_{1}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\right)\ln\nu_{0}+\left(1-\frac{\left|r_{1}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\right)\ln\nu_{1}
\end{align*}

\end_inset


\end_layout

\end_inset

both of which are equivalent to
\begin_inset Formula 
\begin{align*}
\ln\alpha & =\left(\frac{\left|r_{1}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\right)\ln\nu_{0}-\left(\frac{\left|r_{0}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\right)\ln\nu_{1}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsubsection
Complete Refraction Model
\end_layout

\begin_layout Standard
Overall, the spherically symmetric exponential model satisfying the desired
 boundary values is
\begin_inset Formula 
\begin{align*}
\nu\left(r\right) & =e^{\ln\alpha-\beta\left|r\right|}\\
\ln\alpha & =\left(\frac{\left|r_{1}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\right)\ln\nu_{0}-\left(\frac{\left|r_{0}\right|}{\left|r_{1}\right|-\left|r_{0}\right|}\right)\ln\nu_{1}\\
\beta & =\frac{\ln\nu_{0}-\ln\nu_{1}}{\left|r_{1}\right|-\left|r_{0}\right|}
\end{align*}

\end_inset


\end_layout

\begin_layout Section
\start_of_appendix
Differential Approach
\end_layout

\begin_layout Subsection
Path Description
\end_layout

\begin_layout Standard
Let the path be represented by position vector, 
\begin_inset Formula $r$
\end_inset

, as a function of path length, 
\begin_inset Formula $\lambda$
\end_inset

.
 I.e.
 the function, 
\begin_inset Formula $r\left(\lambda\right)$
\end_inset

, describes the path over some half open [begin,end) interval, 
\begin_inset Formula $\lambda_{b}\le\lambda<\lambda_{e}$
\end_inset

.
\end_layout

\begin_layout Standard
The tangent vector, 
\begin_inset Formula $t$
\end_inset

, as a function of 
\begin_inset Formula $\lambda$
\end_inset

, i.e.
 
\begin_inset Formula $t\left(\lambda\right)$
\end_inset

, is the (vector) derivative,
\begin_inset Formula 
\[
t\left(\lambda\right)=\frac{dr}{d\lambda}=\dot{r}
\]

\end_inset

and for Cartesian expression of 
\begin_inset Formula $r=\sum_{k}\rho_{k}e_{k}$
\end_inset

, then
\begin_inset Formula 
\[
\dot{r}=\sum_{k}\frac{\partial\rho_{k}}{\partial\lambda}e_{k}
\]

\end_inset


\end_layout

\begin_layout Subsection
Another New Try
\end_layout

\begin_layout Standard
At a spatially sharp boundary location (e.g.
 at path length, 
\begin_inset Formula $\lambda$
\end_inset

), the incident tangent vector, 
\begin_inset Formula $t_{p}$
\end_inset

, is deflected by a small amount 
\begin_inset Formula $\Delta_{t}$
\end_inset

 to become the exiting tangent direction, 
\begin_inset Formula $t_{n}$
\end_inset

.
 The deflection is in accordance with Snel's law in association with the
 values of refraction on either side of the boundary, and with the direction
 of the gradient at the boundary location.
\begin_inset Formula 
\[
\nu_{p}\left(t_{p}\wedge g\right)=\nu_{n}\left(t_{n}\wedge g\right)
\]

\end_inset


\end_layout

\begin_layout Standard
Consider the ideal boundary interface to be centered on a thin layer with
 edges a distance, 
\begin_inset Formula $\pm\delta_{\lambda}$
\end_inset

, along the curving path.
\end_layout

\begin_layout Standard
The above 
\begin_inset Quotes eld
\end_inset

previous-next
\begin_inset Quotes erd
\end_inset

 relationship describes the behavior of the path leaving this layer at path
 distance, 
\begin_inset Formula $\lambda+\delta_{\lambda}$
\end_inset

, relative to the behavior entering the thin layer (at 
\begin_inset Formula $\lambda-\delta_{\lambda}$
\end_inset

).
\end_layout

\begin_layout Standard
The tangent direction at the entrance/exit of this thin layer can be expressed
 in terms of the tangent direction at the boundary, 
\begin_inset Formula $t$
\end_inset

, and the rate of change of the tangent direction with respect to path length
 
\begin_inset Formula $\lambda$
\end_inset

.
 I.e.
\begin_inset Formula 
\begin{align*}
t_{p} & =t-\dot{t}\delta_{\lambda}\\
t_{n} & =t+\dot{t}\delta_{\lambda}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
The index of refraction at the entrance/exit of the layer can be expressed
 by evaluating the IoR field function at the boundary layer and then estimating
 its value based on the rate of change of the IoR field w.r.t.
 path length,
\begin_inset Formula 
\begin{align*}
\nu_{p} & =\nu-\dot{\nu}\delta_{\lambda}\\
\nu_{n} & =\nu+\dot{\nu}\delta_{\lambda}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
The index of refraction at the entrance/exit of the layer can be expressed
 by evaluating the IoR field function at locations that are 
\begin_inset Formula $\pm\delta_{\lambda}$
\end_inset

 distance along the path from the location of a point on the boundary, 
\begin_inset Formula $r$
\end_inset

.
 I.e.
\begin_inset Formula 
\begin{align*}
\nu_{p} & =\nu\left(r_{p}\right)=\nu\left(r-t\delta_{\lambda}\right)\\
\nu_{n} & =\nu\left(r_{n}\right)=\nu\left(r+t\delta_{\lambda}\right)
\end{align*}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Insert these values into the finite refraction relationship
\begin_inset Formula 
\[
\left(\nu-\dot{\nu}\delta_{\lambda}\right)\left(\left(t-\dot{t}\delta_{\lambda}\right)\wedge g\right)=\left(\nu+\dot{\nu}\delta_{\lambda}\right)\left(\left(t+\dot{t}\delta_{\lambda}\right)\wedge g\right)
\]

\end_inset

After expanding and rearranging this, the terms not involving 
\begin_inset Formula $\delta_{\lambda}$
\end_inset

 cancel from the left and right sides.
 Then gathering like terms together, yields
\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
Rearrange this
\begin_inset Formula 
\[
\nu t\wedge g-\nu\delta_{\lambda}\dot{t}\wedge g-\dot{\nu}\delta_{\lambda}\left(t\wedge g-\delta_{\lambda}\dot{t}\wedge g\right)=\nu t\wedge g+\nu\delta_{\lambda}\dot{t}\wedge g+\dot{\nu}\delta_{\lambda}\left(t\wedge g+\delta_{\lambda}\dot{t}\wedge g\right)
\]

\end_inset

The first term on each side cancel.
 After rearranging the remaining terms
\begin_inset Formula 
\[
\nu\delta_{\lambda}\dot{t}\wedge g+\dot{\nu}\delta_{\lambda}\left(t\wedge g+\delta_{\lambda}\dot{t}\wedge g\right)+\nu\delta_{\lambda}\dot{t}\wedge g+\dot{\nu}\delta_{\lambda}\left(t\wedge g-\delta_{\lambda}\dot{t}\wedge g\right)=0
\]

\end_inset


\begin_inset Formula 
\[
2\nu\delta_{\lambda}\dot{t}\wedge g+2\dot{\nu}\delta_{\lambda}\left(t\wedge g+\delta_{\lambda}\dot{t}\wedge g\right)=0
\]

\end_inset


\end_layout

\end_inset


\begin_inset Formula 
\[
2\delta_{\lambda}\left(\nu\dot{t}\wedge g+\dot{\nu}t\wedge g\right)+2\delta_{\lambda}^{2}\left(\dot{\nu}\dot{t}\wedge g\right)=0
\]

\end_inset


\end_layout

\begin_layout Standard
This represents the finite refraction change that occurs over the thin layer
 having a thickness of about 
\begin_inset Formula $2\delta_{\lambda}$
\end_inset

.
 As 
\begin_inset Formula $\delta_{\lambda}\rightarrow0$
\end_inset

, the second term becomes relatively insignificant compared with the first.
 For the first term to be zero, for small but otherwise arbitrary 
\begin_inset Formula $\delta_{\lambda}$
\end_inset

 values, requires that
\begin_inset Formula 
\[
\nu\dot{t}\wedge g+\dot{\nu}t\wedge g=0
\]

\end_inset


\end_layout

\begin_layout Standard
Note that the IoR and gradient values are evaluated at the same location
 as 
\begin_inset Formula $t$
\end_inset

 and 
\begin_inset Formula $\dot{t}$
\end_inset

, so that this is an 
\begin_inset Quotes eld
\end_inset

instantaneously true
\begin_inset Quotes erd
\end_inset

 relationship.
\end_layout

\begin_layout Standard
Overall,
\begin_inset Formula 
\[
\dot{t}\wedge g=\dot{\nu}\nu^{-1}t\wedge g
\]

\end_inset


\end_layout

\begin_layout Standard
Next require that the change in tangent be orthogonal to the tangent (requiring
 
\begin_inset Formula $\lambda$
\end_inset

 to change such that 
\begin_inset Formula $t$
\end_inset

 is constant magnitude).
 Then also
\begin_inset Formula 
\[
\dot{t}\cdot t=0
\]

\end_inset

Expanding the wedge and dot products
\begin_inset Formula 
\begin{align*}
\dot{t}g-g\dot{t} & =2\dot{\nu}\nu^{-1}t\wedge g\\
\dot{t}t+t\dot{t} & =0
\end{align*}

\end_inset

Add these
\begin_inset Formula 
\[
\left(t-g\right)\dot{t}+\dot{t}\left(t+g\right)=2\dot{\nu}\nu^{-1}t\wedge g
\]

\end_inset


\end_layout

\begin_layout Standard
This is Sylvester's equation (cf Appendix
\begin_inset space ~
\end_inset

TODO) which has solution
\begin_inset Formula 
\begin{align*}
\dot{t} & =\frac{Db-aD}{b^{2}-a^{2}}\\
a & \equiv t-g\\
b & \equiv t+g\\
D & \equiv2\dot{\nu}\nu^{-1}t\wedge g
\end{align*}

\end_inset

Here
\begin_inset Formula 
\begin{align*}
a^{2} & =t^{2}+g^{2}-2t\cdot g\\
b^{2} & =t^{2}+g^{2}+2t\cdot g
\end{align*}

\end_inset

so that
\begin_inset Formula 
\[
b^{2}-a^{2}=4t\cdot g
\]

\end_inset


\end_layout

\begin_layout Standard
Overall,
\begin_inset Formula 
\[
\dot{t}=\frac{1}{4t\cdot g}\left[\left(2\dot{\nu}\nu^{-1}t\wedge g\right)\left(t+g\right)-\left(t-g\right)\left(2\dot{\nu}\nu^{-1}t\wedge g\right)\right]
\]

\end_inset


\begin_inset Formula 
\[
\dot{t}=\frac{\dot{\nu}\nu^{-1}}{2t\cdot g}\left[\left(t\wedge g\right)\left(t+g\right)-\left(t-g\right)\left(t\wedge g\right)\right]
\]

\end_inset

Since 
\begin_inset Formula $t$
\end_inset

 and 
\begin_inset Formula $g$
\end_inset

 are in the plane of 
\begin_inset Formula $t\wedge g$
\end_inset

, they both anti-commute such that
\begin_inset Formula 
\[
\dot{t}=\frac{\dot{\nu}\nu^{-1}}{2t\cdot g}\left[\left(t\wedge g\right)\left(t+g\right)--\left(t\wedge g\right)\left(t-g\right)\right]
\]

\end_inset


\begin_inset Formula 
\[
\dot{t}=\frac{\dot{\nu}\nu^{-1}}{t\cdot g}\left[\left(t\wedge g\right)\left(t+g\right)\right]
\]

\end_inset


\end_layout

\begin_layout Subsection
A New Try
\end_layout

\begin_layout Standard
At a spatially sharp boundary location (e.g.
 at path length, 
\begin_inset Formula $\lambda$
\end_inset

), the incident tangent vector, 
\begin_inset Formula $t_{p}$
\end_inset

, is deflected by a small amount 
\begin_inset Formula $\Delta_{t}$
\end_inset

 to become the exiting tangent direction, 
\begin_inset Formula $t_{n}$
\end_inset

.
 The deflection is in accordance with Snel's law in association with the
 values of refraction on either side of the boundary, and with the direction
 of the gradient at the boundary location.
\begin_inset Formula 
\[
\nu_{p}\left(t_{p}\wedge u\right)=\nu_{n}\left(t_{n}\wedge u\right)
\]

\end_inset


\end_layout

\begin_layout Standard
These values can be expressed in terms of changes relative to the respective
 values at the boundary TODO/TBD how to define the delta values?
\begin_inset Formula 
\[
\left(\nu-\delta_{\nu}\right)\left(\left(t-d_{t}\right)\wedge\left(u-d_{u}\right)\right)=\left(\nu+\delta_{\nu}\right)\left(\left(t+d_{t}\right)\wedge\left(u+d_{u}\right)\right)
\]

\end_inset

rearranging
\begin_inset Formula 
\[
\left(\nu+\delta_{\nu}\right)\left(\left(t+d_{t}\right)\wedge\left(u+d_{u}\right)\right)-\left(\nu-\delta_{\nu}\right)\left(\left(t-d_{t}\right)\wedge\left(u-d_{u}\right)\right)=0
\]

\end_inset


\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
Noting the pattern on each side
\begin_inset Formula 
\begin{align*}
\left(\nu\pm\delta_{\nu}\right)\left(\left(t\pm d_{t}\right)\wedge\left(u\pm d_{u}\right)\right) & =\nu\left(t\wedge u\right)\\
 & \pm\nu\left(t\wedge d_{u}\right)\\
 & \pm\nu\left(d_{t}\wedge u\right)\\
 & \pm\pm\nu\left(d_{t}\wedge d_{u}\right)\\
 & \pm\delta_{\nu}\left(t\wedge u\right)\\
 & \pm\pm\delta_{\nu}\left(t\wedge d_{u}\right)\\
 & \pm\pm\delta_{\nu}\left(d_{t}\wedge u\right)\\
 & \pm\pm\pm\delta_{\nu}\left(d_{t}\wedge d_{u}\right)
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
\left(\nu\pm\delta_{\nu}\right)\left(\left(t\pm d_{t}\right)\wedge\left(u\pm d_{u}\right)\right) & =\nu\left(t\wedge u\right)\\
 & \pm\nu\left(t\wedge d_{u}\right)\\
 & \pm\nu\left(d_{t}\wedge u\right)\\
 & +\nu\left(d_{t}\wedge d_{u}\right)\\
 & \pm\delta_{\nu}\left(t\wedge u\right)\\
 & +\delta_{\nu}\left(t\wedge d_{u}\right)\\
 & +\delta_{\nu}\left(d_{t}\wedge u\right)\\
 & \pm\delta_{\nu}\left(d_{t}\wedge d_{u}\right)
\end{align*}

\end_inset


\end_layout

\begin_layout Plain Layout
Expand each side
\begin_inset Formula 
\begin{align*}
+\nu\left(t\wedge u\right) & -+\nu\left(t\wedge u\right)\\
+\nu\left(t\wedge d_{u}\right) & --\nu\left(t\wedge d_{u}\right)\\
+\nu\left(d_{t}\wedge u\right) & --\nu\left(d_{t}\wedge u\right)\\
+\nu\left(d_{t}\wedge d_{u}\right) & -+\nu\left(d_{t}\wedge d_{u}\right)\\
+\delta_{\nu}\left(t\wedge u\right) & --\delta_{\nu}\left(t\wedge u\right)\\
+\delta_{\nu}\left(t\wedge d_{u}\right) & -+\delta_{\nu}\left(t\wedge d_{u}\right)\\
+\delta_{\nu}\left(d_{t}\wedge u\right) & -+\delta_{\nu}\left(d_{t}\wedge u\right)\\
+\delta_{\nu}\left(d_{t}\wedge d_{u}\right) & --\delta_{\nu}\left(d_{t}\wedge d_{u}\right)
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
\\
+\nu\left(t\wedge d_{u}\right) & +\nu\left(t\wedge d_{u}\right)\\
+\nu\left(d_{t}\wedge u\right) & +\nu\left(d_{t}\wedge u\right)\\
\\
+\delta_{\nu}\left(t\wedge u\right) & +\delta_{\nu}\left(t\wedge u\right)\\
\\
\\
+\delta_{\nu}\left(d_{t}\wedge d_{u}\right) & +\delta_{\nu}\left(d_{t}\wedge d_{u}\right)
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
+2\nu\left(t\wedge d_{u}\right)\\
+2\nu\left(d_{t}\wedge u\right)\\
+2\delta_{\nu}\left(t\wedge u\right)\\
+2\delta_{\nu}\left(d_{t}\wedge d_{u}\right) & =0
\end{align*}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Expanding the two terms (and dividing by factor of two), lead to
\begin_inset Formula 
\[
\delta_{\nu}\left(t\wedge u\right)+\nu\left(d_{t}\wedge u\right)+\nu\left(t\wedge d_{u}\right)+\delta_{\nu}\left(d_{t}\wedge d_{u}\right)=0
\]

\end_inset


\end_layout

\begin_layout Standard
Divide by the corresponding small change in path length, 
\begin_inset Formula $\delta_{\lambda}$
\end_inset

, to express this relationship as
\begin_inset Formula 
\[
\frac{\delta_{\nu}}{\delta_{\lambda}}\left(t\wedge u\right)+\nu\left(\frac{d_{t}}{\delta_{\lambda}}\wedge u\right)+\nu\left(t\wedge\frac{d_{u}}{\delta_{\lambda}}\right)+\delta_{\lambda}^{2}\left[\frac{\delta_{\nu}}{\delta_{\lambda}}\left(\frac{d_{t}}{\delta_{\lambda}}\wedge\frac{d_{u}}{\delta_{\lambda}}\right)\right]=0
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
Try verification here
\end_layout

\end_inset


\begin_inset Formula 
\[
\dot{\nu}\left(t\wedge u\right)+\nu\left(\dot{t}\wedge u\right)+\nu\left(t\wedge\dot{u}\right)+\delta_{\lambda}^{2}\left[\dot{\nu}\left(\dot{t}\wedge\dot{u}\right)\right]=0
\]

\end_inset


\end_layout

\begin_layout Standard
In the limit 
\begin_inset Formula $\delta_{\lambda}\rightarrow0$
\end_inset

, the fractional factors become derivatives, and the last term, 
\begin_inset Formula $\delta_{\lambda}^{2}\left[\dot{\nu}\left(\dot{t}\wedge\dot{u}\right)\right]\rightarrow0$
\end_inset

, such that
\begin_inset Formula 
\[
\dot{\nu}\left(t\wedge u\right)+\nu\left(\dot{t}\wedge u\right)+\nu\left(t\wedge\dot{u}\right)=0
\]

\end_inset


\end_layout

\begin_layout Standard
Gradient
\begin_inset Formula 
\[
g=\gamma u
\]

\end_inset

therefore
\begin_inset Formula 
\[
\dot{g}=\dot{\gamma}u+\gamma\dot{u}
\]

\end_inset

From appendix
\begin_inset Formula 
\[
\dot{u}=\gamma^{-1}\left(\dot{g}\wedge u\right)u
\]

\end_inset


\end_layout

\begin_layout Standard
So that,
\begin_inset Formula 
\[
\dot{\nu}\left(t\wedge u\right)+\nu\left(\dot{t}\wedge u\right)+\nu\left(t\wedge\left(\gamma^{-1}\left(\dot{g}\wedge u\right)u\right)\right)=0
\]

\end_inset

or
\begin_inset Formula 
\[
\dot{u}=\gamma^{-1}\left(\dot{g}-\dot{\gamma}u\right)=\gamma^{-1}\left(\dot{g}-\left(\dot{g}\cdot u\right)u\right)
\]

\end_inset


\begin_inset Formula 
\[
\dot{\nu}\left(t\wedge u\right)+\nu\left(\dot{t}\wedge u\right)+\nu\left(t\wedge\gamma^{-1}\left(\dot{g}-\left(\dot{g}\cdot u\right)u\right)\right)=0
\]

\end_inset


\begin_inset Formula 
\[
\dot{\nu}\left(t\wedge u\right)+\nu\left(\dot{t}\wedge u\right)+\nu\gamma^{-1}\left(t\wedge\dot{g}-\left(\dot{g}\cdot u\right)t\wedge u\right)=0
\]

\end_inset


\begin_inset Formula 
\[
\nu\left(\dot{t}\wedge u\right)+\left(\dot{\nu}-\nu\gamma^{-1}\left(\dot{g}\cdot u\right)\right)\left(t\wedge u\right)+\nu\gamma^{-1}\left(t\wedge\dot{g}\right)=0
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Note Comment
status open

\begin_layout Plain Layout
These values can be expressed in terms of changes relative to the respective
 values at the boundary TODO/TBD how to define the delta values?
\begin_inset Formula 
\[
\left(\nu-\Delta_{\nu}\right)\left(\left(t-\Delta_{t}\right)\wedge u\right)=\left(\nu+\Delta_{\nu}\right)\left(\left(t+\Delta_{t}\right)\wedge u\right)
\]

\end_inset


\begin_inset Formula 
\[
\left(\nu+\Delta_{\nu}\right)\left(\left(t+\Delta_{t}\right)\wedge u\right)-\left(\nu-\Delta_{\nu}\right)\left(\left(t-\Delta_{t}\right)\wedge u\right)=0
\]

\end_inset

Expanding this leads to
\begin_inset Formula 
\[
\left(\nu\left(t\wedge u+\Delta_{t}\wedge u\right)+\Delta_{\nu}\left(t\wedge u+\Delta_{t}\wedge u\right)\right)-\left(\nu\left(t\wedge u-\Delta_{t}\wedge u\right)-\Delta_{\nu}\left(t\wedge u-\Delta_{t}\wedge u\right)\right)=0
\]

\end_inset


\begin_inset Formula 
\[
\nu\left(t\wedge u+\Delta_{t}\wedge u\right)+\Delta_{\nu}\left(t\wedge u+\Delta_{t}\wedge u\right)-\nu\left(t\wedge u-\Delta_{t}\wedge u\right)+\Delta_{\nu}\left(t\wedge u-\Delta_{t}\wedge u\right)=0
\]

\end_inset


\begin_inset Formula 
\[
\nu\left(t\wedge u+\Delta_{t}\wedge u\right)-\nu\left(t\wedge u-\Delta_{t}\wedge u\right)+\Delta_{\nu}\left(t\wedge u+\Delta_{t}\wedge u\right)+\Delta_{\nu}\left(t\wedge u-\Delta_{t}\wedge u\right)=0
\]

\end_inset


\begin_inset Formula 
\[
\nu t\wedge u+\nu\Delta_{t}\wedge u-\nu t\wedge u+\nu\Delta_{t}\wedge u+\Delta_{\nu}t\wedge u+\Delta_{\nu}\Delta_{t}\wedge u+\Delta_{\nu}t\wedge u-\Delta_{\nu}\Delta_{t}\wedge u=0
\]

\end_inset


\begin_inset Formula 
\[
2\nu\Delta_{t}\wedge u+2\Delta_{\nu}t\wedge u=0
\]

\end_inset

which does NOT account for changing direction of gradient.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Refraction
\end_layout

\begin_layout Standard
At a spatially instantaneous location (e.g.
 at path length position, 
\begin_inset Formula $\lambda$
\end_inset

), the incident tangent vector, 
\begin_inset Formula $t_{p}$
\end_inset

, is deflected by a small amount 
\begin_inset Formula $\Delta_{t}$
\end_inset

 by the IoR field gradient, 
\begin_inset Formula $g_{p}$
\end_inset

, in accordance with Snel's law, the same functional form of this 
\begin_inset Quotes eld
\end_inset

previous
\begin_inset Quotes erd
\end_inset

 condition must also hold on the 
\begin_inset Quotes eld
\end_inset

next
\begin_inset Quotes erd
\end_inset

 portion of the refracted path,
\end_layout

\begin_layout Standard
If considering an infinitesimal surface interface, then there is only a
 single, gradient, 
\begin_inset Formula $g$
\end_inset

, associated with the surface at the point where the ray penetrates it.
 In this case,
\begin_inset Formula 
\[
\nu_{p}\left(t_{p}\wedge g\right)=\nu_{n}\left(t_{n}\wedge g\right)
\]

\end_inset


\end_layout

\begin_layout Standard
However, now consider the surface, and also the following thin film of refractiv
e media over which the gradient changes direction.
 In this case there is also a change in the gradient over this thin film
 of media, such that
\begin_inset Formula 
\[
\nu_{p}\left(t_{p}\wedge g_{p}\right)=\nu_{n}\left(t_{n}\wedge g_{p}\right)
\]

\end_inset


\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
Consider three portions of the media starting with 
\begin_inset Quotes eld
\end_inset

previous
\begin_inset Quotes erd
\end_inset

 zone 
\begin_inset Formula $0$
\end_inset

, then a very (infinitesimally) thin layer of zone 
\begin_inset Formula $1$
\end_inset

, ending in the subsequent 
\begin_inset Quotes eld
\end_inset

next
\begin_inset Quotes erd
\end_inset

 media in zone 
\begin_inset Formula $2$
\end_inset

.
 For these two boundaries (0-1 and 1-2),
\begin_inset Formula 
\[
\nu_{0}t_{0}\wedge g_{0}=\nu_{1}t_{1}\wedge g_{1}
\]

\end_inset

and
\begin_inset Formula 
\[
\nu_{1}t_{1}\wedge g_{1}=\nu_{2}t_{2}\wedge g_{2}
\]

\end_inset


\begin_inset Formula 
\[
\nu_{0}t_{0}\wedge g_{0}=\nu_{1}t_{1}\wedge g_{0}=\nu_{1}t_{1}\wedge g_{1}=\nu_{2}t_{2}\wedge g_{2}
\]

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The refracted, or 
\begin_inset Quotes eld
\end_inset

next
\begin_inset Quotes erd
\end_inset

 quantities on the right, may be expressed as small perturbations of the
 incident, or 
\begin_inset Quotes eld
\end_inset

previous
\begin_inset Quotes erd
\end_inset

 quantities on the left as
\begin_inset Formula 
\[
\nu_{p}\left(t_{p}\wedge g_{p}\right)=\left(\nu_{p}+\Delta_{\nu}\right)\left(\left(t_{p}+\Delta_{t}\right)\wedge\left(g_{p}+\Delta_{g}\right)\right)
\]

\end_inset

where
\end_layout

\begin_layout Itemize
\begin_inset Formula $\Delta_{\nu}$
\end_inset

 is a scalar small change in refraction
\end_layout

\begin_layout Itemize
\begin_inset Formula $\Delta_{t}$
\end_inset

 is a vector change in direction or propagation.
 NOTE in order to not change the length of the tangent vector, 
\begin_inset Formula $t$
\end_inset

, this change must be perpendicular to 
\begin_inset Formula $t$
\end_inset

 such that 
\begin_inset Formula $\Delta_{t}\cdot t=0$
\end_inset

.
\end_layout

\begin_layout Itemize
\begin_inset Formula $\Delta_{g}$
\end_inset

 is a vector change in the gradient of refraction.
 TODO/TBD Snel's law assumes a constant gradient of refraction.
 Therefore, this term represents and extension to the domain of validity
 of Snel's relationship.
\end_layout

\begin_layout Standard
To first order in the changes, this expands to
\begin_inset Formula 
\begin{align*}
\nu_{p}t_{p}\wedge g_{p} & =\nu_{p}t_{p}\wedge g_{p}+\Delta_{\nu}t_{p}\wedge g_{p}+\nu_{p}\Delta_{t}\wedge g_{p}+\nu t_{p}\wedge\Delta_{g}+\mathcal{O}\left(\Delta^{2}\right)
\end{align*}

\end_inset

where the 
\begin_inset Formula $\mathcal{O}\left(\Delta^{2}\right)$
\end_inset

 represents terms of second and higher order in the small changes.
\end_layout

\begin_layout Standard
The first term on the left cancels, such that, to first order approximation,
\begin_inset Formula 
\[
\Delta_{\nu}t_{p}\wedge g_{p}+\nu\Delta_{t}\wedge g_{p}+\nu_{p}t_{p}\wedge\Delta_{g}+\mathcal{O}\left(\Delta^{2}\right)=0
\]

\end_inset


\end_layout

\begin_layout Standard
NOTE 
\begin_inset Note Note
status open

\begin_layout Plain Layout
TODO
\end_layout

\end_inset

/TBD - this assumes net effect coplanarity of the terms.
 I.e.
 that 
\begin_inset Formula $\Delta_{g}$
\end_inset

 is directed such that the sum 
\begin_inset Formula $\left(\Delta_{t}\wedge g+t\wedge\Delta_{g}\right)$
\end_inset

 is parallel to the (generally nonzero) first term involving 
\begin_inset Formula $t_{p}\wedge g_{p}$
\end_inset

.
 I.e.
 
\begin_inset Formula $\Delta_{t}$
\end_inset

 needs to change in a way such that 
\begin_inset Quotes eld
\end_inset

rotation
\begin_inset Quotes erd
\end_inset

 in 
\begin_inset Formula $\Delta_{t}\wedge g$
\end_inset

 offsets any rotation in the environment specified term 
\begin_inset Formula $t\wedge\Delta_{g}$
\end_inset

.
\end_layout

\begin_layout Standard
Divide this by the path length, 
\begin_inset Formula $\Delta_{\lambda}$
\end_inset

, over which this change is occurring, to obtain
\begin_inset Formula 
\[
\frac{\Delta_{\nu}}{\Delta_{\lambda}}t_{p}\wedge g_{p}+\nu\frac{\Delta_{t}}{\Delta_{\lambda}}\wedge g_{p}+\nu_{p}t_{p}\wedge\frac{\Delta_{g}}{\Delta_{\lambda}}+\mathcal{O}\left(\Delta^{2}\right)=0
\]

\end_inset

Then take the limit as this layer of the media goes to zero (in which case,
 the higher order terms become increasingly negligible),
\begin_inset Formula 
\[
\lim_{\Delta_{\lambda}\rightarrow0}\left\{ \frac{\Delta_{\nu}}{\Delta_{\lambda}}t_{p}\wedge g_{p}+\nu\frac{\Delta_{t}}{\Delta_{\lambda}}\wedge g_{p}+\nu_{p}t_{p}\frac{\Delta_{g}}{\Delta_{\lambda}}\right\} =0
\]

\end_inset

In the limit, the fractions are derivatives of 
\begin_inset Formula $\nu$
\end_inset

, 
\begin_inset Formula $t$
\end_inset

, and 
\begin_inset Formula $g$
\end_inset

, with respect to the path evolution parameter, 
\begin_inset Formula $\lambda$
\end_inset

.
 I.e.
\begin_inset Formula 
\[
\frac{\partial\nu}{\partial\lambda}t_{p}\wedge g_{p}+\nu\frac{\partial t}{\partial\lambda}\wedge g_{p}+\nu_{p}t_{p}\wedge\frac{\partial g}{\partial\lambda}=0
\]

\end_inset


\end_layout

\begin_layout Standard
However, not that the above derivation includes the requirement that 
\begin_inset Formula $\Delta_{t}\cdot t=0$
\end_inset

, which may now be expressed as 
\begin_inset Formula $\dot{t}\cdot t=0$
\end_inset

, such that the complete relationship is specified by the constrained system
 of equations,
\end_layout

\begin_layout Standard
Since this relationship applies at arbitrary locations along the path the
 
\begin_inset Quotes eld
\end_inset

previous
\begin_inset Quotes erd
\end_inset

 subscript notation can be dropped and the full relationship may be expressed
 (with over-dot notation for derivatives with respect to 
\begin_inset Formula $\lambda$
\end_inset

) as,
\begin_inset Formula 
\begin{align}
\dot{\nu}t\wedge g+\nu\dot{t}\wedge g+\nu t\wedge\dot{g} & =0\label{eq:RefractInvariant}\\
\dot{t}\cdot t & =0\label{eq:RefractConstraint}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
This is consistent with first assuming
\begin_inset Formula 
\[
\nu t\wedge g=\kappa
\]

\end_inset

for some constant, 
\begin_inset Formula $\kappa$
\end_inset

, and then applying the product differentiation rule on the left which provides
 the necessary condition of equation
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:RefractInvariant"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
 However, it misses the action of constraining the magnitude of the path
 direction as specified by equation
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:RefractConstraint"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
 However, together, equations
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:RefractInvariant"
plural "false"
caps "false"
noprefix "false"

\end_inset

 and
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:RefractConstraint"
plural "false"
caps "false"
noprefix "false"

\end_inset

 provide a sufficient expression of the path propagation 
\begin_inset Note Note
status open

\begin_layout Plain Layout
TODO
\end_layout

\end_inset

/TBD - do they?
\end_layout

\begin_layout Subsection
=== Solve Temp
\end_layout

\begin_layout Standard
Express equations
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:RefractInvariant"
plural "false"
caps "false"
noprefix "false"

\end_inset

 and
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:RefractConstraint"
plural "false"
caps "false"
noprefix "false"

\end_inset

 as
\begin_inset Formula 
\begin{align*}
2g\wedge\dot{t} & =2\nu^{-1}\dot{\nu}t\wedge g+2t\wedge\dot{g}\\
2t\cdot\dot{t} & =0
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
g\dot{t}-\dot{t}g & =2\nu^{-1}\dot{\nu}t\wedge g+2t\wedge\dot{g}\\
t\dot{t}+\dot{t}t & =0
\end{align*}

\end_inset

Note that this does NOT constraint the scalar grade of 
\begin_inset Formula $g\dot{t}$
\end_inset

.
 I.e.
 
\begin_inset Formula $g\cdot\dot{t}$
\end_inset

 is free to be any scalar value.
 
\end_layout

\begin_layout Standard
Add these
\begin_inset Formula 
\[
\left(t+g\right)\dot{t}+\dot{t}\left(t-g\right)=2\nu^{-1}\dot{\nu}t\wedge g+2t\wedge\dot{g}
\]

\end_inset


\begin_inset Formula 
\[
\left(t+g\right)\dot{t}+\dot{t}\left(t-g\right)=2t\wedge\left(\frac{\dot{\nu}}{\nu}g+\dot{g}\right)
\]

\end_inset


\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
\begin_inset Formula 
\[
2g\wedge\dot{t}+\dot{t}\cdot t=2t\wedge\left(\frac{\dot{\nu}}{\nu}g+\dot{g}\right)
\]

\end_inset


\begin_inset Formula 
\[
2\dot{t}\wedge g=-2t\wedge\left(\frac{\dot{\nu}}{\nu}g+\dot{g}\right)
\]

\end_inset


\begin_inset Formula 
\[
\dot{t}\wedge g=-t\wedge\left(\frac{\dot{\nu}}{\nu}g+\dot{g}\right)
\]

\end_inset


\end_layout

\end_inset

Then use
\begin_inset Formula 
\[
\dot{\nu}=\frac{\partial\nu}{\partial\lambda}=\sum_{k}\frac{\partial\nu}{\partial\rho_{k}}\frac{\partial\rho_{k}}{\partial\lambda}=\nabla\nu\cdot\dot{r}=\nabla\nu\cdot t=g\cdot t
\]

\end_inset


\begin_inset Formula 
\begin{align*}
\dot{g} & =\sum_{j}e_{j}\nabla\gamma_{j}\cdot t
\end{align*}

\end_inset

To obtain
\begin_inset Formula 
\[
\left(t+g\right)\dot{t}+\dot{t}\left(t-g\right)=2t\wedge\left(\frac{g\cdot t}{\nu}g+\sum_{j}e_{j}\nabla\gamma_{j}\cdot t\right)
\]

\end_inset


\begin_inset Formula 
\[
\left(t+g\right)\dot{t}+\dot{t}\left(t-g\right)=D
\]

\end_inset

where
\begin_inset Formula 
\[
D=2t\wedge\left(\frac{g\cdot t}{\nu}g+\sum_{j}e_{j}\nabla\gamma_{j}\cdot t\right)
\]

\end_inset


\end_layout

\begin_layout Standard
In summary,
\begin_inset Formula 
\begin{align*}
e_{j}\nabla\gamma_{j}\cdot t & =\left(\sum_{k}\mathrm{H}_{jk}\tau_{k}\right)e_{j}\\
\mathrm{H}_{jk} & \equiv\frac{\partial^{2}\nu}{\partial\rho_{j}\partial\rho_{k}}
\end{align*}

\end_inset


\begin_inset Formula 
\[
g=\sum_{k}\frac{\partial\nu}{\partial\rho_{k}}e_{k}
\]

\end_inset


\begin_inset Formula 
\[
D=2t\wedge\left(\frac{\sum_{k}\frac{\partial\nu}{\partial\rho_{k}}\tau_{k}}{\nu}\left(\sum_{j}\frac{\partial\nu}{\partial\rho_{j}}e_{j}\right)+\sum_{j}\left(\sum_{k}\mathrm{H}_{jk}\tau_{k}\right)e_{j}\right)
\]

\end_inset


\begin_inset Formula 
\[
D=2t\wedge\left[\sum_{j}\left(\frac{1}{\nu}\frac{\partial\nu}{\partial\rho_{j}}\sum_{k}\frac{\partial\nu}{\partial\rho_{k}}\tau_{k}+\sum_{k}\frac{\partial^{2}\nu}{\partial\rho_{j}\partial\rho_{k}}\tau_{k}\right)e_{j}\right]
\]

\end_inset


\begin_inset Formula 
\[
D=2t\wedge\left[\sum_{j}\left(\frac{1}{\nu}g_{j}\sum_{k}g_{k}\tau_{k}+\sum_{k}\mathrm{H}_{jk}\tau_{k}\right)e_{j}\right]
\]

\end_inset


\begin_inset Formula 
\[
D=2\left[\sum_{j}\left(\frac{1}{\nu}g_{j}\sum_{k}g_{k}\tau_{k}+\sum_{k}\mathrm{H}_{jk}\tau_{k}\right)t\wedge e_{j}\right]
\]

\end_inset

where 
\begin_inset Formula $\mathrm{H}$
\end_inset

 is the Hessian matrix for the index of refraction scalar field.
\end_layout

\begin_layout Standard
Note that the first term in 
\begin_inset Formula $D$
\end_inset

 is directed along 
\begin_inset Formula $g$
\end_inset

 such that the trivector grade is zero, i.e.
 
\begin_inset Formula $g\wedge\left(t\wedge\frac{g\cdot t}{\nu}g\right)=0$
\end_inset

.
 For the second term,
\end_layout

\begin_layout Standard
Could consider, 
\begin_inset Formula $t\wedge e_{j}$
\end_inset

 
\begin_inset Formula 
\begin{align*}
t\wedge e_{1} & =\left(\tau_{1}e_{1}+\tau_{2}e_{2}+\tau_{3}e_{3}\right)\wedge e_{1}\\
 & =\tau_{2}e_{21}+\tau_{3}e_{31}\\
 & =-\tau_{2}e_{12}+\tau_{3}e_{31}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
t\wedge e_{2} & =\left(\tau_{1}e_{1}+\tau_{2}e_{2}+\tau_{3}e_{3}\right)\wedge e_{2}\\
 & =\tau_{1}e_{12}-\tau_{3}e_{23}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
t\wedge e_{3} & =\left(\tau_{1}e_{1}+\tau_{2}e_{2}+\tau_{3}e_{3}\right)\wedge e_{3}\\
 & =-\tau_{1}e_{31}+\tau_{2}e_{23}
\end{align*}

\end_inset

Then 
\begin_inset Formula $t\wedge e_{j}\left(v_{j}\cdot t\right)$
\end_inset

for 
\begin_inset Formula $v_{1,2,3}=a,b,c$
\end_inset


\begin_inset Formula 
\[
a\cdot t=\sum_{k}\alpha_{k}\tau_{k}
\]

\end_inset

etc
\begin_inset Formula 
\begin{align*}
t\wedge e_{1}\left(a\cdot t\right) & =\left(-\tau_{2}e_{12}+\tau_{3}e_{31}\right)\left(\alpha_{1}\tau_{1}+\alpha_{2}\tau_{2}+\alpha_{3}\tau_{3}\right)
\end{align*}

\end_inset


\begin_inset Formula 
\[
t\wedge e_{2}\left(b\cdot t\right)=\left(\tau_{1}e_{12}-\tau_{3}e_{23}\right)\left(\beta_{1}\tau_{1}+\beta_{2}\tau_{2}+\beta_{3}\tau_{3}\right)
\]

\end_inset


\begin_inset Formula 
\[
t\wedge e_{3}\left(c\cdot t\right)=\left(-\tau_{1}e_{31}+\tau_{2}e_{23}\right)\left(\gamma_{1}\tau_{1}+\gamma_{2}\tau_{2}+\gamma_{3}\tau_{3}\right)
\]

\end_inset

For the sum of these, the nine 
\begin_inset Formula $\alpha_{k}$
\end_inset

, 
\begin_inset Formula $\beta_{k}$
\end_inset

, and 
\begin_inset Formula $\gamma_{k}$
\end_inset

 scalars (determined by the Hessian of the IoR scalar field) can take on
 values such that the bivector sum contains an arbitrary direction (such
 as 
\begin_inset Formula $g$
\end_inset

).
\begin_inset Formula 
\[
t\wedge\left(e_{1}\left(a\cdot t\right)+e_{2}\left(b\cdot t\right)+e_{3}\left(c\cdot t\right)\right)=0
\]

\end_inset


\begin_inset Formula 
\begin{align*}
0= & -\tau_{2}\left(a\cdot t\right)e_{12}+\tau_{3}\left(a\cdot t\right)e_{31}\\
 & +\tau_{1}\left(b\cdot t\right)e_{12}-\tau_{3}\left(b\cdot t\right)e_{23}\\
 & -\tau_{1}\left(c\cdot t\right)e_{31}+\tau_{2}\left(c\cdot t\right)e_{23}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
0= & +\tau_{2}\left(c\cdot t\right)e_{23}-\tau_{3}\left(b\cdot t\right)e_{23}\\
 & +\tau_{3}\left(a\cdot t\right)e_{31}-\tau_{1}\left(c\cdot t\right)e_{31}\\
 & +\tau_{1}\left(b\cdot t\right)e_{12}-\tau_{2}\left(a\cdot t\right)e_{12}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
0= & +\left(\tau_{2}\left(c\cdot t\right)-\tau_{3}\left(b\cdot t\right)\right)e_{23}\\
 & +\left(\tau_{3}\left(a\cdot t\right)-\tau_{1}\left(c\cdot t\right)\right)e_{31}\\
 & +\left(\tau_{1}\left(b\cdot t\right)-\tau_{2}\left(a\cdot t\right)\right)e_{12}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
0= & +\left(\tau_{2}\left(\gamma_{1}\tau_{1}+\gamma_{2}\tau_{2}+\gamma_{3}\tau_{3}\right)-\tau_{3}\left(\beta_{1}\tau_{1}+\beta_{2}\tau_{2}+\beta_{3}\tau_{3}\right)\right)e_{23}\\
 & +\left(\tau_{3}\left(\alpha_{1}\tau_{1}+\alpha_{2}\tau_{2}+\alpha_{3}\tau_{3}\right)-\tau_{1}\left(\gamma_{1}\tau_{1}+\gamma_{2}\tau_{2}+\gamma_{3}\tau_{3}\right)\right)e_{31}\\
 & +\left(\tau_{1}\left(\beta_{1}\tau_{1}+\beta_{2}\tau_{2}+\beta_{3}\tau_{3}\right)-\tau_{2}\left(\alpha_{1}\tau_{1}+\alpha_{2}\tau_{2}+\alpha_{3}\tau_{3}\right)\right)e_{12}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
0= & +\left(\gamma_{1}\tau_{1}\tau_{2}+\gamma_{2}\tau_{2}\tau_{2}+\gamma_{3}\tau_{2}\tau_{3}-\beta_{1}\tau_{3}\tau_{1}-\beta_{2}\tau_{2}\tau_{3}-\beta_{3}\tau_{3}\tau_{3}\right)e_{23}\\
 & +\left(\alpha_{1}\tau_{3}\tau_{1}+\alpha_{2}\tau_{2}\tau_{3}+\alpha_{3}\tau_{3}\tau_{3}-\gamma_{1}\tau_{1}\tau_{1}-\gamma_{2}\tau_{1}\tau_{2}-\gamma_{3}\tau_{3}\tau_{1}\right)e_{31}\\
 & +\left(\beta_{1}\tau_{1}\tau_{1}+\beta_{2}\tau_{1}\tau_{2}+\beta_{3}\tau_{3}\tau_{1}-\alpha_{1}\tau_{1}\tau_{2}-\alpha_{2}\tau_{2}\tau_{2}-\alpha_{3}\tau_{2}\tau_{3}\right)e_{12}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
0= & +\left(\gamma_{1}\tau_{1}\tau_{2}+\gamma_{2}\tau_{2}^{2}+\gamma_{3}\tau_{2}\tau_{3}-\beta_{1}\tau_{3}\tau_{1}-\beta_{2}\tau_{2}\tau_{3}-\beta_{3}\tau_{3}^{2}\right)e_{23}\\
 & +\left(\alpha_{1}\tau_{3}\tau_{1}+\alpha_{2}\tau_{2}\tau_{3}+\alpha_{3}\tau_{3}^{2}-\gamma_{1}\tau_{1}^{2}-\gamma_{2}\tau_{1}\tau_{2}-\gamma_{3}\tau_{3}\tau_{1}\right)e_{31}\\
 & +\left(\beta_{1}\tau_{1}^{2}+\beta_{2}\tau_{1}\tau_{2}+\beta_{3}\tau_{3}\tau_{1}-\alpha_{1}\tau_{1}\tau_{2}-\alpha_{2}\tau_{2}^{2}-\alpha_{3}\tau_{2}\tau_{3}\right)e_{12}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
0= & +\left(\gamma_{2}\tau_{2}^{2}-\beta_{3}\tau_{3}^{2}+\left(\gamma_{3}-\beta_{2}\right)\tau_{2}\tau_{3}-\beta_{1}\tau_{3}\tau_{1}+\gamma_{1}\tau_{1}\tau_{2}\right)e_{23}\\
 & +\left(-\gamma_{1}\tau_{1}^{2}+\alpha_{3}\tau_{3}^{2}+\alpha_{2}\tau_{2}\tau_{3}+\left(\alpha_{1}-\gamma_{3}\right)\tau_{3}\tau_{1}-\gamma_{2}\tau_{1}\tau_{2}\right)e_{31}\\
 & +\left(\beta_{1}\tau_{1}^{2}-\alpha_{2}\tau_{2}^{2}-\alpha_{3}\tau_{2}\tau_{3}+\beta_{3}\tau_{3}\tau_{1}+\left(\beta_{2}-\alpha_{1}\right)\tau_{1}\tau_{2}\right)e_{12}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
Effectively this represents an implicit constraint on the values of 
\begin_inset Formula $\tau_{k}$
\end_inset

 which must satisfy this relationship so that there is no trivector term
 in the differential equation for 
\begin_inset Formula $\dot{t}$
\end_inset

.
\end_layout

\begin_layout Subsection
Refraction Invariant
\end_layout

\begin_layout Standard
The bivector quantity, 
\begin_inset Formula $\nu\left(t\wedge g\right)$
\end_inset

, is a refraction invariant - in the instantaneous sense
\begin_inset Foot
status open

\begin_layout Plain Layout
Interpretation of Snel's law is that speed of propagation is constant while
 path curves (rather than v.v.
 as in EM theory).
 The direction of curvature changes depending on changes in the direction
 of the index gradient.
\end_layout

\end_inset

.
 Consider this to be constant, and differentiate, w.r.t.
 path length 
\begin_inset Formula $\lambda$
\end_inset

, to obtain
\begin_inset Formula 
\[
\dot{\nu}\left(t\wedge g\right)+\nu\left(\dot{t}\wedge g\right)+\nu\left(t\wedge\dot{g}\right)=0
\]

\end_inset

or
\begin_inset Formula 
\[
\nu^{-1}\dot{\nu}\left(t\wedge g\right)+\dot{t}\wedge g+t\wedge\dot{g}=0
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
NOTE: 
\begin_inset Note Note
status open

\begin_layout Plain Layout
TODO
\end_layout

\end_inset

/TBD - The assumption that 
\begin_inset Formula $\nu t\wedge g$
\end_inset

 is constant really considers only magnitude.
 In reality, the direction associated with the plane of interaction (incidence/r
efraction) can vary as well.
 Therefore, it is not reasonable to expect that the right hand side (RHS)
 be strictly zero.
 If the RHS is forced to zero (as here), then it is not unreasonable to
 expect that the to-be-determined value, 
\begin_inset Formula $\dot{t}$
\end_inset

, may not be a strict vector quantity.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Although, for Snel's law to hold, the change in path direction, 
\begin_inset Formula $\dot{t}$
\end_inset

, must be orthogonal to the current tangent, i.e.
 
\begin_inset Formula $\dot{t}\cdot t=0$
\end_inset

.
 (I.e.
 Snel's law expresses only the change in direction of the path tangent -
 assuming there is no change in magnitude - (e.g.
 is expressed assuming unit tangent direction vectors).
\end_layout

\begin_layout Standard
A point on the path may be represented by the position vector, 
\begin_inset Formula $r$
\end_inset

.
 The tangent vector, 
\begin_inset Formula $t$
\end_inset

, is aligned with (proportional to) the path derivative of 
\begin_inset Formula $r$
\end_inset

, i.e.
\begin_inset Formula 
\[
t\propto\dot{r}=\frac{\partial r}{\partial\lambda}
\]

\end_inset


\end_layout

\begin_layout Standard
Define the tangent vector to have the magnitude 
\begin_inset Formula $\left|\dot{r}\right|$
\end_inset

, such that and for 
\begin_inset Formula $r$
\end_inset

 in Cartesian form (
\begin_inset Formula $r=\sum_{k}\rho_{k}e_{k}$
\end_inset

), then
\begin_inset Formula 
\[
t\equiv\dot{r}=\frac{\partial r}{\partial\lambda}=\sum_{k}\frac{\partial\rho_{k}}{\partial\lambda}
\]

\end_inset


\end_layout

\begin_layout Standard
The derivative of the scalar index of refraction field, may be expressed
 in terms of Cartesian decomposition of vector as,
\begin_inset Formula 
\[
\dot{\nu}=\frac{\partial\nu}{\partial\lambda}=\sum_{k}\frac{\partial\nu}{\partial\rho_{k}}\frac{\partial\rho_{k}}{\partial\lambda}=\nabla\nu\cdot\dot{r}=\nabla\nu\cdot t=g\cdot t
\]

\end_inset


\end_layout

\begin_layout Standard
The derivative of the tangent direction is
\begin_inset Formula 
\[
\dot{t}=\frac{\partial t}{\partial\lambda}=\frac{\partial}{\partial\lambda}\frac{\partial r}{\partial\lambda}=\frac{\partial^{2}}{\partial\lambda^{2}}r=\ddot{r}
\]

\end_inset


\end_layout

\begin_layout Standard
The derivative of the vector gradient field, 
\begin_inset Formula $g=\nabla\nu$
\end_inset

, may be expressed in terms of Cartesian decomposition of 
\begin_inset Formula $r=\sum_{k}\rho_{k}e_{k}$
\end_inset

.
 I.e.
 for 
\begin_inset Formula $\nu=\nu\left(r=\sum_{k}\rho_{k}e_{k}\right)$
\end_inset

, then the gradient
\begin_inset Formula 
\[
g\equiv\nabla\nu=\sum_{k}\frac{\partial\nu}{\partial\rho_{k}}e_{k}=\sum_{k}\gamma_{k}e_{k}
\]

\end_inset

for
\begin_inset Formula 
\[
\gamma_{k}\equiv\frac{\partial\nu}{\partial\rho_{k}}
\]

\end_inset


\end_layout

\begin_layout Standard
The path length derivative of the gradient (a second rank tensor) may be
 expressed as
\begin_inset Formula 
\[
\dot{g}=\frac{\partial g}{\partial\lambda}=\frac{\partial}{\partial\lambda}\sum_{j}\gamma_{j}e_{j}=\sum_{k}\sum_{j}\frac{\partial\gamma_{j}e_{j}}{\partial\rho_{k}}\frac{\partial\rho_{k}}{\partial\lambda}=\sum_{k,j}e_{j}\frac{\partial\gamma_{j}}{\partial\rho_{k}}\left(\frac{\partial\rho_{k}}{\partial\lambda}\right)
\]

\end_inset


\begin_inset Formula 
\begin{align*}
\dot{g} & =\sum_{j}e_{j}\nabla\gamma_{j}\cdot\dot{r}\\
 & =\sum_{j}e_{j}\nabla\gamma_{j}\cdot t
\end{align*}

\end_inset


\end_layout

\begin_layout Subsubsection
Evaluation of 
\begin_inset Formula $\nabla\gamma_{j}$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
g=\nabla\nu=\sum_{j}\frac{\partial\nu}{\partial\rho_{j}}e_{j}=\sum_{j}\gamma_{j}e_{j}
\]

\end_inset


\begin_inset Formula 
\[
\gamma_{j}\equiv\frac{\partial\nu}{\partial\rho_{j}}
\]

\end_inset


\begin_inset Formula 
\[
\nabla\gamma_{j}=\sum_{k}\frac{\partial\gamma_{j}}{\partial\rho_{k}}e_{k}
\]

\end_inset


\begin_inset Formula 
\[
\nabla\gamma_{j}=\sum_{k}\frac{\partial\left(\frac{\partial\nu}{\partial\rho_{j}}\right)}{\partial\rho_{k}}e_{k}=\sum_{k}\frac{\partial^{2}}{\partial\rho_{k}\partial\rho_{j}}e_{k}
\]

\end_inset


\end_layout

\begin_layout Subsubsection
Differential Algebraic Relationship
\end_layout

\begin_layout Standard
So that overall, substitution into the refraction invariant
\begin_inset Formula 
\[
\nu^{-1}\left(g\cdot t\right)\left(t\wedge g\right)+\dot{t}\wedge g+\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)=0
\]

\end_inset

together with the constraint condition that
\begin_inset Formula 
\[
\dot{t}\cdot t=0
\]

\end_inset

Together, these form a first order, non-linear, differential algebraic equation
 system.
\end_layout

\begin_layout Standard
\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
For 
\begin_inset Formula $t=\sum_{k}\tau_{k}e_{k}$
\end_inset

, the wedge products may be expressed as
\begin_inset Formula 
\[
t\wedge e_{j}=\sum_{k}\tau_{k}e_{k}\wedge e_{j}=\sum_{k}\tau_{k}e_{kj}
\]

\end_inset


\begin_inset Formula 
\[
\left(\tau_{1}e_{1}+\tau_{2}e_{2}+\tau_{3}e_{3}\right)\wedge\left(\beta_{1}e_{1}+\beta_{2}e_{2}+\beta_{3}e_{3}\right)
\]

\end_inset

for 
\begin_inset Formula 
\[
\beta_{j}\equiv\left(\nabla\gamma_{j}\cdot\dot{r}\right)
\]

\end_inset


\begin_inset Formula 
\[
\left(\beta_{1}\left(\tau_{1}e_{1}+\tau_{2}e_{2}+\tau_{3}e_{3}\right)\wedge e_{1}+\beta_{2}\left(\tau_{1}e_{1}+\tau_{2}e_{2}+\tau_{3}e_{3}\right)\wedge e_{2}+\beta_{3}\left(\tau_{1}e_{1}+\tau_{2}e_{2}+\tau_{3}e_{3}\right)\wedge e_{3}\right)
\]

\end_inset


\begin_inset Formula 
\[
\left(\beta_{1}\left(\tau_{2}e_{2}+\tau_{3}e_{3}\right)\wedge e_{1}+\beta_{2}\left(\tau_{1}e_{1}+\tau_{3}e_{3}\right)\wedge e_{2}+\beta_{3}\left(\tau_{1}e_{1}+\tau_{2}e_{2}\right)\wedge e_{3}\right)
\]

\end_inset


\begin_inset Formula 
\[
\beta_{1}\left(-\tau_{2}e_{12}+\tau_{3}e_{31}\right)+\beta_{2}\left(\tau_{1}e_{12}-\tau_{3}e_{32}\right)+\beta_{3}\left(-\tau_{1}e_{31}+\tau_{2}e_{23}\right)
\]

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The two equations can be combined as follows.
\end_layout

\begin_layout Standard
First rearrange the refraction invariant
\begin_inset Formula 
\[
\nu^{-1}\left(g\cdot t\right)\left(t\wedge g\right)-g\wedge\dot{t}+\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)=0
\]

\end_inset


\begin_inset Formula 
\[
g\wedge\dot{t}=\nu^{-1}\left(g\cdot t\right)\left(t\wedge g\right)+\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)
\]

\end_inset

Then multiply by 
\begin_inset Formula $2$
\end_inset

, and expand the definition of the wedge product.
 Also expand the dot product in the the constraint condition to express
 both as geometric products in 
\begin_inset Formula $\dot{t}$
\end_inset

,
\begin_inset Formula 
\begin{align*}
g\dot{t}-\dot{t}g & =2\nu^{-1}\left(g\cdot t\right)\left(t\wedge g\right)+2\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)\\
t\dot{t}+\dot{t}t & =0
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
Add these together to obtain
\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
\begin_inset Formula 
\[
t\dot{t}+g\dot{t}+\dot{t}t-\dot{t}g=2\nu^{-1}\left(\nabla\nu\cdot t\right)\left(t\wedge g\right)+2\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)
\]

\end_inset


\end_layout

\end_inset


\begin_inset Formula 
\[
\left(t+g\right)\dot{t}+\dot{t}\left(t-g\right)=2\left(\nu^{-1}\left(g\cdot t\right)\left(t\wedge g\right)+\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)\right)
\]

\end_inset

which provides a (currently implicit) expression for the first deriviative,
 
\begin_inset Formula $\dot{t}$
\end_inset

, in terms of a (complicated) function of the direction, 
\begin_inset Formula $t$
\end_inset

, and various environment index of refraction (IoR) field properties.
\end_layout

\begin_layout Standard
This is a bivector grade equation.
 I.e.
 the left hand side is a spinor quantity and the right hand side is a pure
 bivector grade.
 This requires that the scalar grade on the left side vanish identically
 which has been enforced by the construction (in requiring that 
\begin_inset Formula $\dot{t}\perp t$
\end_inset

).
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
TODO
\end_layout

\end_inset

/TBD - Note that for the coefficients on the right, both 
\begin_inset Formula $t+g$
\end_inset

 and 
\begin_inset Formula $t-g$
\end_inset

 anti commute with the first term on the right.
 In addition, the vector, 
\begin_inset Formula $t$
\end_inset

, anti commutes with the second term n the right.
 However, it seems the vector 
\begin_inset Formula $g$
\end_inset

 has general geometric product behavior with the second term on the right.
 I.e.
 what is the form of
\begin_inset Formula 
\[
2g\left(t\wedge e_{1}\right)=gte_{1}-ge_{1}t
\]

\end_inset


\begin_inset Formula 
\[
\left(a\wedge b\right)_{k}=\left(a_{i}b_{j}-a_{j}b_{i}\right)e_{ij}
\]

\end_inset


\begin_inset Formula 
\begin{align*}
te_{j} & =\left(\tau_{1}e_{1}+\tau_{2}e_{2}+\tau_{3}e_{3}\right)e_{1}\\
 & =\left(\tau_{1}e_{1}e_{1}+\tau_{2}e_{2}e_{1}+\tau_{3}e_{3}e_{1}\right)\\
 & =\left(\tau_{1}-\tau_{2}e_{12}+\tau_{3}e_{31}\right)
\end{align*}

\end_inset


\begin_inset Formula 
\[
\left(te_{1}\right)_{i}=\tau_{j}e_{j1}
\]

\end_inset


\begin_inset Formula 
\begin{align*}
te_{j}-e_{j}t & =\tau_{1}e_{1j}+\tau_{2}e_{2j}+\tau_{3}e_{3j}-e_{j1}\tau_{1}-e_{j2}\tau_{2}-e_{j3}\tau_{2}\\
 & =\tau_{1}e_{1j}+\tau_{2}e_{2j}+\tau_{3}e_{3j}+e_{1j}\tau_{1}+e_{2j}\tau_{2}+e_{3j}\tau_{2}\\
 & =\tau_{1}e_{1j}+\tau_{2}e_{2j}+\tau_{3}e_{3j}+e_{1j}\tau_{1}+e_{2j}\tau_{2}+e_{3j}\tau_{2}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
Solution
\end_layout

\begin_layout Standard
Consider equation of the form
\begin_inset Formula 
\[
aX+Xb=D
\]

\end_inset

where 
\begin_inset Formula $a=t+g$
\end_inset

, 
\begin_inset Formula $b=t-g$
\end_inset

, are vectors and 
\begin_inset Formula $D$
\end_inset

 is a pure bivector grade element.
 This is Sylvester's equation which has solution (
\begin_inset Note Note
status open

\begin_layout Plain Layout
TODO
\end_layout

\end_inset

/TBD - ref Sylvester.lyx document)
\begin_inset Formula 
\[
X=\frac{aD-Db}{a^{2}-b^{2}}
\]

\end_inset

This may also be expressed as
\begin_inset Formula 
\[
X=\frac{\left(a+b\right)\cdot D}{a^{2}-b^{2}}+\frac{\left(a-b\right)\wedge D}{a^{2}-b^{2}}
\]

\end_inset


\end_layout

\begin_layout Standard
This equation may be associated with the application at hand by making the
 identifications,
\begin_inset Formula 
\begin{align*}
x & =\dot{t}\\
a & =t+g\\
b & =t-g\\
D & =2\left(\nu^{-1}\left(g\cdot t\right)\left(t\wedge g\right)+\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)\right)
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
The solution exists provided the denominator is not zero - i.e.
 provided that 
\begin_inset Formula $a^{2}\ne b^{2}$
\end_inset

.
\end_layout

\begin_layout Standard
The scalar denominator may be evaluated by noting that
\begin_inset Formula 
\[
a^{2}=t^{2}+tg+gt+g^{2}=t^{2}+g^{2}+2t\cdot g
\]

\end_inset


\begin_inset Formula 
\[
b^{2}=t^{2}-tg-gt+g^{2}=t^{2}+g^{2}-2t\cdot g
\]

\end_inset

so that
\begin_inset Formula 
\[
a^{2}-b^{2}=4t\cdot g
\]

\end_inset

This is non zero provided that 
\begin_inset Formula $t\ne0$
\end_inset

, 
\begin_inset Formula $g\ne0$
\end_inset

, and 
\begin_inset Formula $t$
\end_inset

 is not orthogonal to 
\begin_inset Formula $g$
\end_inset

.
\end_layout

\begin_layout Standard
After substitution for 
\begin_inset Formula $a+b=2t$
\end_inset

 and 
\begin_inset Formula $a-b=2g$
\end_inset

 and the denominator, the solution may be expressed
\begin_inset Formula 
\[
X=\frac{1}{2t\cdot g}\left(t\cdot D+g\wedge D\right)
\]

\end_inset


\begin_inset Note Note
status open

\begin_layout Plain Layout
TODO
\end_layout

\end_inset

/TBD from the derivation above, it is expected that 
\begin_inset Formula $X=\dot{t}$
\end_inset

 should be a pure vector.
 However, this general solution may include trivector grade (unless 
\begin_inset Formula $g$
\end_inset

 is parallel to the plane of 
\begin_inset Formula $D$
\end_inset

).
 TODO/TBD - resolve what's going on here.
 Possibly 
\begin_inset Formula $D$
\end_inset

 is of a form that ends up always including the direction, 
\begin_inset Formula $g$
\end_inset

.
 (true for the first term in 
\begin_inset Formula $D$
\end_inset

).
\end_layout

\begin_layout Standard
Since 
\begin_inset Formula $X=\dot{t}$
\end_inset

 is required to be a pure vector, (by formulation and construction in developing
 the original equation), this enforces the condition that the trivector
 grade of the last term vanish identically, i.e.
 
\begin_inset Formula $g\wedge D=0$
\end_inset

.
 This is effectively an implicit constraint on the differential relationship.
\end_layout

\begin_layout Standard
\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
In general, the solution, 
\begin_inset Formula $\check{x}$
\end_inset

, could be expected to comprise vector and trivector grades only.
 If 
\begin_inset Formula $\check{x}$
\end_inset

 were to have a scalar grade, that would commute with 
\begin_inset Formula $a$
\end_inset

 and 
\begin_inset Formula $b$
\end_inset

 and contribute a vector to the right hand side which is not present.
 If 
\begin_inset Formula $\check{x}$
\end_inset

 were to have a bivector constituent, then both terms on the left would
 generate vector and trivector grade results which are also not present
 on the right.
 Therefore, the solution to this equation (in which 
\begin_inset Formula $D$
\end_inset

 is a pure bivector), can be expected to have both vector and trivector
 grades.
 (For the specific application at hand above, the trivector portion should
 vanish identically).
\end_layout

\end_inset


\end_layout

\begin_layout Standard
After substitution for 
\begin_inset Formula $D$
\end_inset

,
\begin_inset Formula 
\begin{align*}
\dot{t} & =\frac{1}{t\cdot g}\left(t\cdot\left[\nu^{-1}\left(g\cdot t\right)\left(t\wedge g\right)+\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)\right]\right)\\
 & +\frac{1}{t\cdot g}\left(\left[\nu^{-1}\left(g\cdot t\right)\cancelto{0}{g\wedge\left(t\wedge g\right)}+g\wedge\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)\right]\right)
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
\dot{t} & =\frac{1}{t\cdot g}\left(t\cdot\left[\nu^{-1}\left(g\cdot t\right)\left(t\wedge g\right)+\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)\right]\right)\\
 & +\frac{1}{t\cdot g}\left(g\wedge\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)\right)
\end{align*}

\end_inset

for which the trivector grade on the second line must vanish I.e.
 this is a constrained differential equation system of the form,
\begin_inset Formula 
\begin{align*}
\dot{t} & =\frac{1}{t\cdot g}\left(t\cdot\left[\nu^{-1}\left(g\cdot t\right)\left(t\wedge g\right)+\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)\right]\right)\\
0 & =\frac{1}{t\cdot g}\left(g\wedge\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)\right)
\end{align*}

\end_inset

The constraint is a condition on 
\begin_inset Formula $t$
\end_inset

 (not on 
\begin_inset Formula $\dot{t}$
\end_inset

).
 Could it be that this wouldn't affect the solution to the first equation
 (e.g.
 that some sort of 'complementary' criterion is already incorporated into
 the first equation?
\end_layout

\begin_layout Subsubsection
Checks
\end_layout

\begin_layout Paragraph
Zero Gradient
\end_layout

\begin_layout Standard
Consider if 
\begin_inset Formula $g=0$
\end_inset

, (
\begin_inset Formula $\gamma_{j}=0$
\end_inset

), results in invalid solution case (denominator goes to zero - as does
 numerator)
\begin_inset Formula 
\begin{align*}
\dot{t} & =\frac{1}{t\cdot g}\left(t\cdot\left[\nu^{-1}\left(g\cdot t\right)\left(t\wedge g\right)\cancelto{0}{+\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)}\right]\right)\\
 & +\frac{1}{t\cdot g}\left(g\wedge\left[\nu^{-1}\left(g\cdot t\right)\left(t\wedge g\right)+\cancelto{0}{+\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)}\right]\right)
\end{align*}

\end_inset

Noting that the numerator terms are of order 
\begin_inset Formula $\left|g\right|^{2}$
\end_inset

, while denominator is of order 
\begin_inset Formula $\left|g\right|$
\end_inset

, it can be expected that this has limit case
\begin_inset Formula 
\[
\lim_{\left|g\right|\rightarrow0}\left\{ \dot{t}\right\} =0
\]

\end_inset


\end_layout

\begin_layout Paragraph
Constant Gradient
\end_layout

\begin_layout Standard
If 
\begin_inset Formula $g=\text{const}$
\end_inset

, then 
\begin_inset Formula $\nabla\gamma_{j}=0$
\end_inset

 so that
\begin_inset Formula 
\begin{align*}
\dot{t} & =\frac{1}{t\cdot g}\left(t\cdot\left[\nu^{-1}\left(g\cdot t\right)\left(t\wedge g\right)\cancelto{0}{+\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)}\right]\right)\\
 & +\frac{1}{t\cdot g}\left(g\wedge\left[\nu^{-1}\left(g\cdot t\right)\left(t\wedge g\right)+\cancelto{0}{+\sum_{j}\left(\nabla\gamma_{j}\cdot t\right)\left(t\wedge e_{j}\right)}\right]\right)
\end{align*}

\end_inset


\end_layout

\begin_layout Section
Differential Relationships
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
TODO
\end_layout

\end_inset

/TBD - Tentative and Probably Wrong
\end_layout

\begin_layout Standard
Note that 
\begin_inset Formula $\nu=\nu\left(r\right)$
\end_inset

 and 
\begin_inset Formula $r=r\left(\lambda\right)$
\end_inset

, so that
\begin_inset Formula 
\[
\dot{\nu}=\frac{d\nu}{d\lambda}=\sum\frac{\partial\nu}{\partial\rho_{k}}\frac{d\rho_{k}}{d\lambda}=\nabla\nu\cdot\dot{r}
\]

\end_inset


\end_layout

\begin_layout Standard
The tangent vector is given by the position derivative w.r.t.
 arc length,
\begin_inset Formula 
\[
\dot{r}=\frac{dr}{d\lambda}=t
\]

\end_inset


\end_layout

\begin_layout Standard
The derivative (wrt 
\begin_inset Formula $\lambda$
\end_inset

) of the gradient is
\begin_inset Formula 
\[
\dot{g}=\frac{dg}{d\lambda}=\frac{d}{d\lambda}\sum\frac{\partial\nu}{\partial\rho_{k}}e_{k}=\sum\frac{d}{d\lambda}\frac{\partial\nu}{\partial\rho_{k}}e_{k}
\]

\end_inset


\begin_inset Formula 
\[
\dot{g}=\lim_{\Delta\lambda\rightarrow0}\frac{g\left(r+\Delta\lambda\dot{r}\right)-g\left(r\right)}{\Delta\lambda}
\]

\end_inset


\begin_inset Formula 
\[
g=g\left(r\right)
\]

\end_inset


\begin_inset Formula 
\[
\dot{g}=\frac{dg}{d\lambda}=\frac{dg}{d\rho_{1}}\frac{d\rho_{1}}{d\lambda}+\frac{dg}{d\rho_{2}}\frac{d\rho_{2}}{d\lambda}+\frac{dg}{d\rho_{3}}\frac{d\rho_{3}}{d\lambda}
\]

\end_inset


\begin_inset Note Comment
status collapsed

\begin_layout Plain Layout
\begin_inset Formula 
\[
\frac{dg}{d\lambda}=\frac{d}{d\rho_{1}}\left(\sum\frac{d\nu}{d\rho_{k}}e_{k}\right)\frac{d\rho_{1}}{d\lambda}+\frac{d}{d\rho_{2}}\left(\sum\frac{d\nu}{d\rho_{k}}e_{k}\right)\frac{d\rho_{2}}{d\lambda}+\frac{d}{d\rho_{3}}\left(\sum\frac{d\nu}{d\rho_{k}}e_{k}\right)\frac{d\rho_{3}}{d\lambda}
\]

\end_inset


\begin_inset Formula 
\[
\frac{dg}{d\lambda}=\left(\sum\frac{d^{2}\nu}{d\rho_{1}d\rho_{k}}e_{k}\right)\frac{d\rho_{1}}{d\lambda}+\left(\sum\frac{d^{2}\nu}{d\rho_{2}d\rho_{k}}e_{k}\right)\frac{d\rho_{2}}{d\lambda}+\left(\sum\frac{d^{2}\nu}{d\rho_{3}d\rho_{k}}e_{k}\right)\frac{d\rho_{3}}{d\lambda}
\]

\end_inset


\begin_inset Formula 
\begin{align*}
\frac{dg}{d\lambda} & =\left(\frac{d^{2}\nu}{d\rho_{1}d\rho_{1}}e_{1}+\frac{d^{2}\nu}{d\rho_{1}d\rho_{2}}e_{2}+\frac{d^{2}\nu}{d\rho_{1}d\rho_{3}}e_{3}\right)\dot{r}_{1}\\
 & +\left(\frac{d^{2}\nu}{d\rho_{2}d\rho_{1}}e_{1}+\frac{d^{2}\nu}{d\rho_{2}d\rho_{2}}e_{2}+\frac{d^{2}\nu}{d\rho_{2}d\rho_{3}}e_{3}\right)\dot{r}_{2}\\
 & +\left(\frac{d^{2}\nu}{d\rho_{3}d\rho_{1}}e_{1}+\frac{d^{2}\nu}{d\rho_{3}d\rho_{2}}e_{2}+\frac{d^{2}\nu}{d\rho_{3}d\rho_{3}}e_{3}\right)\dot{r}_{3}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
\frac{dg}{d\lambda} & =\frac{d}{d\rho_{1}}\left(\frac{d\nu}{d\rho_{1}}e_{1}+\frac{d\nu}{d\rho_{2}}e_{2}+\frac{d\nu}{d\rho_{3}}e_{3}\right)\dot{r}_{1}\\
 & +\frac{d}{d\rho_{2}}\left(\frac{d\nu}{d\rho_{1}}e_{1}+\frac{d\nu}{d\rho_{2}}e_{2}+\frac{d\nu}{d\rho_{3}}e_{3}\right)\dot{r}_{2}\\
 & +\frac{d}{d\rho_{3}}\left(\frac{d\nu}{d\rho_{1}}e_{1}+\frac{d\nu}{d\rho_{2}}e_{2}+\frac{d\nu}{d\rho_{3}}e_{3}\right)\dot{r}_{3}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
\frac{dg}{d\lambda} & =\frac{dg}{d\rho_{1}}\dot{r}_{1}\\
 & +\frac{dg}{d\rho_{2}}\dot{r}_{2}\\
 & +\frac{dg}{d\rho_{3}}\dot{r}_{3}
\end{align*}

\end_inset


\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
\dot{g} & =\frac{dg}{d\rho_{1}}\dot{r}_{1}+\frac{dg}{d\rho_{2}}\dot{r}_{2}+\frac{dg}{d\rho_{3}}\dot{r}_{3}
\end{align*}

\end_inset


\begin_inset Formula 
\[
\dot{g}=\frac{dg}{d\rho_{1}}\left(\dot{r}\cdot e_{1}\right)+\frac{dg}{d\rho_{2}}\left(\dot{r}\cdot e_{2}\right)+\frac{dg}{d\rho_{3}}\left(\dot{r}\cdot e_{3}\right)
\]

\end_inset


\begin_inset Formula 
\begin{align*}
\frac{dg}{d\lambda} & =\left(\frac{d^{2}\nu}{d\rho_{1}d\rho_{1}}e_{1}+\frac{d^{2}\nu}{d\rho_{1}d\rho_{2}}e_{2}+\frac{d^{2}\nu}{d\rho_{1}d\rho_{3}}e_{3}\right)\left(\dot{r}\cdot e_{1}\right)\\
 & +\left(\frac{d^{2}\nu}{d\rho_{2}d\rho_{1}}e_{1}+\frac{d^{2}\nu}{d\rho_{2}d\rho_{2}}e_{2}+\frac{d^{2}\nu}{d\rho_{2}d\rho_{3}}e_{3}\right)\left(\dot{r}\cdot e_{2}\right)\\
 & +\left(\frac{d^{2}\nu}{d\rho_{3}d\rho_{1}}e_{1}+\frac{d^{2}\nu}{d\rho_{3}d\rho_{2}}e_{2}+\frac{d^{2}\nu}{d\rho_{3}d\rho_{3}}e_{3}\right)\left(\dot{r}\cdot e_{3}\right)
\end{align*}

\end_inset

In matrix form, the Hessian of 
\begin_inset Formula $g$
\end_inset

, may be defined as the (3x3) matrix
\begin_inset Formula 
\[
\left(\mathrm{H}_{g}\right)_{ij}\equiv\frac{\partial^{2}\nu}{\partial\rho_{i}\partial\rho_{j}}
\]

\end_inset

 The derivative, 
\begin_inset Formula $\dot{g}$
\end_inset

, may be expressed as
\begin_inset Formula 
\[
\dot{g}=\mathrm{H}_{g}\left[\sum\left(\dot{r}\cdot e_{k}\right)e_{k}\right]
\]

\end_inset


\end_layout

\begin_layout Standard
Substitute the above in order to express the refraction invariant as,
\begin_inset Formula 
\[
\nabla\nu\cdot\dot{r}\left(\dot{r}\wedge g\right)+\nu\left(\ddot{r}\wedge g\right)+\nu\left(\dot{r}\wedge\left(\frac{dg}{d\rho_{1}}\dot{r}_{1}+\frac{dg}{d\rho_{2}}\dot{r}_{2}+\frac{dg}{d\rho_{3}}\dot{r}_{3}\right)\right)=0
\]

\end_inset

Multiply from by 
\begin_inset Formula $\nu^{-1}$
\end_inset

,
\begin_inset Formula 
\[
\ddot{r}\wedge g+\frac{\nabla\nu}{\nu}\cdot\dot{r}\left(\dot{r}\wedge g\right)+\left(\dot{r}\wedge\frac{dg}{d\rho_{1}}\right)\dot{r}_{1}+\left(\dot{r}\wedge\frac{dg}{d\rho_{2}}\right)\dot{r}_{2}+\left(\dot{r}\wedge\frac{dg}{d\rho_{3}}\right)\dot{r}_{3}=0
\]

\end_inset


\begin_inset Formula 
\[
\ddot{r}\wedge g+\frac{\nabla\nu}{\nu}\cdot\dot{r}\left(\dot{r}\wedge g\right)+\left(\dot{r}\wedge\frac{\partial g}{\partial\rho_{1}}\right)\dot{r}_{1}+\left(\dot{r}\wedge\frac{\partial g}{\partial\rho_{2}}\right)\dot{r}_{2}+\left(\dot{r}\wedge\frac{\partial g}{\partial\rho_{3}}\right)\dot{r}_{3}=0
\]

\end_inset


\end_layout

\begin_layout Standard
This is a second order, nonlinear, differential equation expressing changes
 to position, 
\begin_inset Formula $r$
\end_inset

, as a function of path length evolution parameter, 
\begin_inset Formula $\lambda$
\end_inset

.
\end_layout

\begin_layout Standard
This should be a necessary condition, however, it is unclear if it is a
 sufficient condition.
\end_layout

\begin_layout Standard
In terms of the index field Hessian matrix,
\begin_inset Formula 
\[
\ddot{r}\wedge g+\frac{\nabla\nu}{\nu}\cdot\dot{r}\left(\dot{r}\wedge g\right)+\dot{r}\wedge\left(\mathrm{H}_{g}\left[\sum\left(\dot{r}\cdot e_{k}\right)e_{k}\right]\right)=0
\]

\end_inset


\begin_inset Formula 
\[
\left(\mathrm{H}_{g}\right)_{ij}\equiv\frac{\partial^{2}\nu}{\partial\rho_{i}\partial\rho_{j}}
\]

\end_inset

Apparently, the first two terms control the curvature and propagation direction
 in the plane of the index gradient while the last term (involving a matrix-vect
or multiplication) introduces a torsion influence capable of changing direction
 of the plane of propagation.
\end_layout

\begin_layout Subsection
Special Case
\end_layout

\begin_layout Standard
\begin_inset Note Note
status open

\begin_layout Plain Layout
TODO
\end_layout

\end_inset

/TBD - Tentative and Probably Wrong
\end_layout

\begin_layout Standard
Consider a plane stratified atmosphere.
 In this case, the only gradient term that survives is, 
\begin_inset Formula $\nabla\nu=\frac{\partial\nu}{\partial\rho_{3}}e_{3}$
\end_inset

.
 And for 
\begin_inset Formula $\mathrm{H}_{g}$
\end_inset

, only the 
\begin_inset Formula $\frac{d^{2}\nu}{d\rho_{3}d\rho_{3}}$
\end_inset

 term survives, so that
\begin_inset Formula 
\[
\ddot{r}\wedge\frac{\partial\nu}{\partial\rho_{3}}e_{3}+\frac{1}{\nu}\frac{\partial\nu}{\partial\rho_{3}}e_{3}\cdot\dot{r}\left(\dot{r}\wedge\frac{\partial\nu}{\partial\rho_{3}}e_{3}\right)+\dot{r}\wedge\left(\frac{\partial^{2}\nu}{\partial\rho_{3}\partial\rho_{3}}\left(\dot{r}\cdot e_{3}\right)e_{3}\right)=0
\]

\end_inset


\begin_inset Formula 
\[
\frac{\partial\nu}{\partial\rho_{3}}\left(\ddot{r}\wedge e_{3}\right)+\frac{1}{\nu}\left(\frac{\partial\nu}{\partial\rho_{3}}\right)^{2}\left(\dot{r}\cdot e_{3}\right)\left(\dot{r}\wedge e_{3}\right)+\frac{\partial^{2}\nu}{\partial\rho_{3}\partial\rho_{3}}\left(\dot{r}\cdot e_{3}\right)\left(\dot{r}\wedge e_{3}\right)=0
\]

\end_inset


\begin_inset Formula 
\[
\frac{\partial\nu}{\partial\rho_{3}}\left(\ddot{r}\wedge e_{3}\right)+\left[\frac{1}{\nu}\left(\frac{\partial\nu}{\partial\rho_{3}}\right)^{2}+\frac{\partial^{2}\nu}{\partial\rho_{3}\partial\rho_{3}}\right]\left(\dot{r}\cdot e_{3}\right)\left(\dot{r}\wedge e_{3}\right)=0
\]

\end_inset


\end_layout

\begin_layout Section
Derivative of Vector
\end_layout

\begin_layout Standard
Consider an arbitrary vector, 
\begin_inset Formula $q$
\end_inset

, that can be decomposed into scalar magnitude, 
\begin_inset Formula $\mu$
\end_inset

, times unitary direction, 
\begin_inset Formula $d$
\end_inset

, as
\begin_inset Formula 
\[
q=\mu d
\]

\end_inset


\end_layout

\begin_layout Standard
The derivative with respect to some arbitrary scalar value, by the differentiati
on product rule, is
\begin_inset Formula 
\begin{equation}
\dot{q}=\dot{\mu}d+\mu\dot{d}\label{eq:qVecDeriv}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Derivative of Magnitude
\end_layout

\begin_layout Standard
The magnitude, 
\begin_inset Formula $\mu$
\end_inset

, of arbitrary vector, 
\begin_inset Formula $q$
\end_inset

, may be defined in terms of the vectors as
\begin_inset Formula 
\[
\mu=\sqrt{q^{2}}=\left(qq\right)^{\frac{1}{2}}
\]

\end_inset

The derivative is
\begin_inset Formula 
\[
\dot{\mu}=\frac{1}{2}\left(qq\right)^{-\frac{1}{2}}\left(\dot{q}q+q\dot{q}\right)
\]

\end_inset

Invoking the definition of vector-vector dot product, and the original magnitude
 definition, this may be expressed as
\begin_inset Formula 
\[
\dot{\mu}=\mu^{-1}\left(q\cdot\dot{q}\right)
\]

\end_inset

Substitute for the decomposition of 
\begin_inset Formula $q$
\end_inset

,
\begin_inset Formula 
\[
\dot{\mu}=\mu^{-1}\left(\left(\mu d\right)\cdot\dot{q}\right)
\]

\end_inset

to obtain
\begin_inset Formula 
\begin{equation}
\dot{\mu}=d\cdot\dot{q}\label{eq:qMagDeriv}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The interpretation is that the change in magnitude is (as expected) the
 component of the change of the full vector, 
\begin_inset Formula $q$
\end_inset

, that is aligned with its own direction, 
\begin_inset Formula $d$
\end_inset

.
\end_layout

\begin_layout Subsection
Derivative of Direction
\end_layout

\begin_layout Standard
The unitary direction, 
\begin_inset Formula $d$
\end_inset

, of vector, 
\begin_inset Formula $q\ne0$
\end_inset

, may be defined as
\begin_inset Formula 
\[
d=\mu^{-1}q
\]

\end_inset

The derivative of this (wrt arbitrary scalar) is
\begin_inset Formula 
\[
\dot{d}=\overline{\mu^{-1}}q+\mu^{-1}\dot{q}
\]

\end_inset


\begin_inset Formula 
\[
\dot{d}=-\mu^{-2}\dot{\mu}q+\mu^{-1}\dot{q}
\]

\end_inset


\begin_inset Formula 
\[
\dot{d}=\mu^{-1}\left(\dot{q}-\mu^{-1}\dot{\mu}q\right)
\]

\end_inset


\begin_inset Formula 
\[
\dot{d}=\mu^{-1}\left(\dot{q}-\mu^{-1}\dot{\mu}\mu d\right)
\]

\end_inset


\begin_inset Formula 
\[
\dot{d}=\mu^{-1}\left(\dot{q}-\dot{\mu}d\right)
\]

\end_inset


\end_layout

\begin_layout Standard
This is consistent with the algebraic solution of equation
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:qVecDeriv"
plural "false"
caps "false"
noprefix "false"

\end_inset

 for 
\begin_inset Formula $\dot{d}$
\end_inset

.
\begin_inset Formula 
\[
\dot{q}=\dot{\mu}d+\mu\dot{d}
\]

\end_inset


\begin_inset Formula 
\[
\mu\dot{d}=\dot{q}-\dot{\mu}d
\]

\end_inset


\begin_inset Formula 
\[
\dot{d}=\mu^{-1}\left(\dot{q}-\dot{\mu}d\right)
\]

\end_inset


\end_layout

\begin_layout Standard
Substitute the value for 
\begin_inset Formula $\dot{\mu}$
\end_inset

, given by equation
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:qMagDeriv"
plural "false"
caps "false"
noprefix "false"

\end_inset

 to obtain an expression
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\dot{d}=\mu^{-1}\left(\dot{q}-\left(d\cdot\dot{q}\right)d\right)\label{eq:qDirDerivDot}
\end{equation}

\end_inset

I.e.
 the change in the direction has two components.
 The first term in parenthesis is proportional to the change in 
\begin_inset Formula $q$
\end_inset

.
 The second term, removes the component of the change in 
\begin_inset Formula $q$
\end_inset

 that is aligned with its own direction, thereby leaving only a component
 tangential to the original 
\begin_inset Formula $q$
\end_inset

.
\end_layout

\begin_layout Standard
The tangential geometry of the direction change may be made explicit by
 expanding the dot product of the term in parenthesis
\begin_inset Formula 
\begin{align*}
\dot{q}-\left(d\cdot\dot{q}\right)d & =\dot{q}-\frac{1}{2}\left(d\dot{q}+\dot{q}d\right)d\\
 & =\dot{q}-\frac{1}{2}\left(d\dot{q}d+\dot{q}\right)\\
 & =\dot{q}-\frac{1}{2}d\dot{q}d-\frac{1}{2}\dot{q}\\
 & =\frac{1}{2}\dot{q}-\frac{1}{2}d\dot{q}d\\
 & =\left(\frac{1}{2}\dot{q}d-\frac{1}{2}d\dot{q}\right)d\\
 & =\left(\dot{q}\wedge d\right)d
\end{align*}

\end_inset

so that overall,
\begin_inset Formula 
\begin{equation}
\dot{d}=\mu^{-1}\left(\dot{q}\wedge d\right)d\label{eq:qDirDerivWedge}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsubsection
Orthogonal Direction Change
\end_layout

\begin_layout Standard
The tangential nature of the derivative of direction may also be demonstrated
 by substituting expression
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:qVecDeriv"
plural "false"
caps "false"
noprefix "false"

\end_inset

 into the expression
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:qMagDeriv"
plural "false"
caps "false"
noprefix "false"

\end_inset

 to obtain
\begin_inset Formula 
\[
\dot{\mu}=\mu^{-1}\left(q\cdot\left(\dot{\mu}d+\mu\dot{d}\right)\right)
\]

\end_inset


\begin_inset Formula 
\[
\dot{\mu}=\mu^{-1}\left(\mu d\cdot\left(\dot{\mu}d+\mu\dot{d}\right)\right)
\]

\end_inset


\begin_inset Formula 
\[
\dot{\mu}=d\cdot\left(\dot{\mu}d+\mu\dot{d}\right)
\]

\end_inset

Since the direction is unitary, 
\begin_inset Formula $d\cdot d=1$
\end_inset

,
\begin_inset Formula 
\[
\dot{\mu}=\dot{\mu}+\mu d\cdot\dot{d}
\]

\end_inset

This requires that 
\begin_inset Formula $d\cdot\dot{d}=0$
\end_inset

, which is expected.
 A change in direction is a rotation of the original vector such that the
 change lies on a sphere and is therefore tangent to the original vector.
\end_layout

\begin_layout Standard
I.e.
\begin_inset Formula 
\[
q\cdot\dot{d}=0
\]

\end_inset


\end_layout

\begin_layout Subsection
Summary
\end_layout

\begin_layout Standard
For arbitrary vector, 
\begin_inset Formula $q$
\end_inset

, decomposed into magnitude, 
\begin_inset Formula $\mu$
\end_inset

, and direction, 
\begin_inset Formula $d$
\end_inset

, factors,
\begin_inset Formula 
\[
q=\mu d
\]

\end_inset

differentiation with respect to an arbitrary scalar may be summarized as
\begin_inset Formula 
\[
\dot{q}=\dot{\mu}d+\mu\dot{d}
\]

\end_inset


\begin_inset Formula 
\[
\dot{\mu}=d\cdot\dot{q}
\]

\end_inset


\begin_inset Formula 
\[
\dot{d}=\mu^{-1}\left(\dot{q}\wedge d\right)d
\]

\end_inset

with
\begin_inset Formula 
\[
q\cdot\dot{d}=0
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset bibtex
LatexCommand bibtex
btprint "btPrintCited"
bibfiles "Papers"

\end_inset


\end_layout

\end_body
\end_document
